<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bruno Gondim - Relatório técnico — Análise de churn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../cup-hot" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Bruno Gondim - Relatório técnico — Análise de churn">
<meta property="og:description" content="">
<meta property="og:site_name" content="Bruno Gondim">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../cup-hot" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Bruno Gondim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-presentations" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Presentations</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-presentations">    
        <li>
    <a class="dropdown-item" href="../../presentations/nlp/index.html">
 <span class="dropdown-text">Agrupador de processos de controle concentrado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/random_forest/apresentacao.html">
 <span class="dropdown-text">Técnicas de Random Forest em árvores de decisão</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/estocasticos/estocasticos.html">
 <span class="dropdown-text">Processos de Poisson não homogêneos de n tipos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/xgboost_catboost/trabalho.html">
 <span class="dropdown-text">XGBoost e Catboost</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/classificacao_salario/trabalho.html">
 <span class="dropdown-text">Classificação com tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/birnbaum/seminario.html">
 <span class="dropdown-text">Modelo de regressão Birnbaum-Saunders reparametrizado pela média</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/classificação binária de decisões/trabalho_final.html">
 <span class="dropdown-text">Classificação binária de decisões</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/classificacao_salario_relatorio/trabalho_bruno.html">
 <span class="dropdown-text">Classificação salarial com Tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/npa/lista1.html">
 <span class="dropdown-text">Geração de NPA’s</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/otim_mv/lista2.html">
 <span class="dropdown-text">Otimização e Máxima Verossimilhança</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/em/lista3.html">
 <span class="dropdown-text">Algoritmo EM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/montecarlo/lista4.html">
 <span class="dropdown-text">Métodos Monte Carlo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentations/tcc2/slide.html">
 <span class="dropdown-text">Similaridade de Processos Judiciários utilizando NLP — Monografia</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://penasta.shinyapps.io/similaridade_processos/">
 <span class="dropdown-text">Similaridade de Processos Judiciários utilizando NLP — Shiny</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.linkedin.com/in/bruno-gondim/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/penasta" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:brunogtoledo96@gmail.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mailbox"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução">Introdução</a></li>
  <li><a href="#metodologia" id="toc-metodologia" class="nav-link" data-scroll-target="#metodologia">Metodologia</a></li>
  <li><a href="#análise" id="toc-análise" class="nav-link" data-scroll-target="#análise">Análise</a>
  <ul class="collapse">
  <li><a href="#taxa-de-churn" id="toc-taxa-de-churn" class="nav-link" data-scroll-target="#taxa-de-churn">Taxa de churn</a></li>
  <li><a href="#quantidade-de-cancelamentos-por-grupos" id="toc-quantidade-de-cancelamentos-por-grupos" class="nav-link" data-scroll-target="#quantidade-de-cancelamentos-por-grupos">Quantidade de cancelamentos por grupos</a></li>
  <li><a href="#cancelamento-por-idade-na-adesão" id="toc-cancelamento-por-idade-na-adesão" class="nav-link" data-scroll-target="#cancelamento-por-idade-na-adesão">Cancelamento por idade na adesão</a></li>
  <li><a href="#cancelamento-por-tempo-de-plano-em-meses" id="toc-cancelamento-por-tempo-de-plano-em-meses" class="nav-link" data-scroll-target="#cancelamento-por-tempo-de-plano-em-meses">Cancelamento por tempo de plano em meses</a></li>
  <li><a href="#cancelamento-pelo-sexo-do-cliente" id="toc-cancelamento-pelo-sexo-do-cliente" class="nav-link" data-scroll-target="#cancelamento-pelo-sexo-do-cliente">Cancelamento pelo sexo do cliente</a></li>
  <li><a href="#cancelamento-por-unidade-da-federação-do-cliente" id="toc-cancelamento-por-unidade-da-federação-do-cliente" class="nav-link" data-scroll-target="#cancelamento-por-unidade-da-federação-do-cliente">Cancelamento por unidade da federação do cliente</a></li>
  <li><a href="#cancelamento-por-inadimplência" id="toc-cancelamento-por-inadimplência" class="nav-link" data-scroll-target="#cancelamento-por-inadimplência">Cancelamento por inadimplência</a></li>
  <li><a href="#cancelamento-por-quantidade-de-consultas-do-cliente-nos-últimos-12-meses" id="toc-cancelamento-por-quantidade-de-consultas-do-cliente-nos-últimos-12-meses" class="nav-link" data-scroll-target="#cancelamento-por-quantidade-de-consultas-do-cliente-nos-últimos-12-meses">Cancelamento por quantidade de consultas do cliente nos últimos 12 meses</a></li>
  <li><a href="#cancelamento-por-quantidade-de-internações-do-cliente-nos-últimos-12-meses" id="toc-cancelamento-por-quantidade-de-internações-do-cliente-nos-últimos-12-meses" class="nav-link" data-scroll-target="#cancelamento-por-quantidade-de-internações-do-cliente-nos-últimos-12-meses">Cancelamento por quantidade de internações do cliente nos últimos 12 meses</a></li>
  <li><a href="#cancelamento-por-valor-da-mensalidade-do-plano" id="toc-cancelamento-por-valor-da-mensalidade-do-plano" class="nav-link" data-scroll-target="#cancelamento-por-valor-da-mensalidade-do-plano">Cancelamento por valor da mensalidade do plano</a></li>
  <li><a href="#renda-por-inadimplência-por-cancelamento" id="toc-renda-por-inadimplência-por-cancelamento" class="nav-link" data-scroll-target="#renda-por-inadimplência-por-cancelamento">Renda por inadimplência por cancelamento</a></li>
  <li><a href="#conclusão-da-análise-exploratória" id="toc-conclusão-da-análise-exploratória" class="nav-link" data-scroll-target="#conclusão-da-análise-exploratória">Conclusão da análise exploratória</a></li>
  </ul></li>
  <li><a href="#modelagem" id="toc-modelagem" class="nav-link" data-scroll-target="#modelagem">Modelagem</a>
  <ul class="collapse">
  <li><a href="#política-para-valores-ausentes" id="toc-política-para-valores-ausentes" class="nav-link" data-scroll-target="#política-para-valores-ausentes">Política para valores ausentes</a></li>
  <li><a href="#construção-de-features" id="toc-construção-de-features" class="nav-link" data-scroll-target="#construção-de-features">Construção de features</a></li>
  <li><a href="#o-modelo-geral" id="toc-o-modelo-geral" class="nav-link" data-scroll-target="#o-modelo-geral">O modelo geral</a></li>
  <li><a href="#pré-processamento" id="toc-pré-processamento" class="nav-link" data-scroll-target="#pré-processamento">Pré processamento</a></li>
  <li><a href="#definindo-modelos" id="toc-definindo-modelos" class="nav-link" data-scroll-target="#definindo-modelos">Definindo modelos</a></li>
  <li><a href="#validação-cruzada-ajuste-dos-modelos-e-tuning-de-hiperparâmetros" id="toc-validação-cruzada-ajuste-dos-modelos-e-tuning-de-hiperparâmetros" class="nav-link" data-scroll-target="#validação-cruzada-ajuste-dos-modelos-e-tuning-de-hiperparâmetros">Validação cruzada, ajuste dos modelos e tuning de hiperparâmetros</a></li>
  <li><a href="#análise-de-importâncias-dos-melhores-modelos" id="toc-análise-de-importâncias-dos-melhores-modelos" class="nav-link" data-scroll-target="#análise-de-importâncias-dos-melhores-modelos">Análise de importâncias dos melhores modelos</a>
  <ul class="collapse">
  <li><a href="#problemáticas-desta-abordagem" id="toc-problemáticas-desta-abordagem" class="nav-link" data-scroll-target="#problemáticas-desta-abordagem">Problemáticas desta abordagem</a></li>
  <li><a href="#solução" id="toc-solução" class="nav-link" data-scroll-target="#solução">Solução</a></li>
  </ul></li>
  <li><a href="#o-modelo-interpretável" id="toc-o-modelo-interpretável" class="nav-link" data-scroll-target="#o-modelo-interpretável">O modelo interpretável</a>
  <ul class="collapse">
  <li><a href="#métricas-do-modelo-interpretável" id="toc-métricas-do-modelo-interpretável" class="nav-link" data-scroll-target="#métricas-do-modelo-interpretável">Métricas do modelo interpretável</a></li>
  <li><a href="#matriz-de-confusão-do-modelo-interpretável" id="toc-matriz-de-confusão-do-modelo-interpretável" class="nav-link" data-scroll-target="#matriz-de-confusão-do-modelo-interpretável">Matriz de confusão do modelo interpretável</a></li>
  <li><a href="#curva-roc-do-modelo-interpretável" id="toc-curva-roc-do-modelo-interpretável" class="nav-link" data-scroll-target="#curva-roc-do-modelo-interpretável">Curva ROC do modelo interpretável</a></li>
  <li><a href="#resultados-do-modelo-e-interpretação" id="toc-resultados-do-modelo-e-interpretação" class="nav-link" data-scroll-target="#resultados-do-modelo-e-interpretação">Resultados do modelo e interpretação</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados">Resultados</a></li>
  <li><a href="#conclusão" id="toc-conclusão" class="nav-link" data-scroll-target="#conclusão">Conclusão</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Relatório técnico — Análise de churn</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Bruno Gondim Toledo</p>
<section id="introdução" class="level1">
<h1>Introdução</h1>
<p>O monitoramento da taxa de churn é essencial para a saúde de uma empresa, pois altas taxas de churn podem indicar baixa aderência entre o perfil do cliente e o produto oferecido. Desta forma, é crucial buscar detectar os fatores que estão contribuindo para este descompasso, bem como realizar previsões para o futuro próximo, com o objetivo de delinear ações estratégicas, táticas e operacionais.</p>
<p>Neste contexto, a ciência de dados se apresenta como uma ferramenta eficaz, e a análise aqui desenvolvida visa diagnosticar os principais determinantes do churn e desenvolver modelos que auxiliem tanto na previsão quanto na compreensão dos fatores associados ao cancelamento de clientes em um plano de saúde.</p>
<p>Para analisar os possíveis fatores relacionados a evasão do cliente no plano de saúde, coletou-se informações individuais de cada cliente, incluindo características sociodemográficas, como sexo, faixa de renda e unidade da federação em que reside, além de atributos relacionados ao produto contratado, como valor da mensalidade e tempo de adesão ao plano.</p>
<p>Na etapa de análise exploratória de dados, analisou-se as relações bivariadas da variável resposta e suas variáveis explicativas, bem como buscou-se encontrar relações multivariadas entre as covariáveis e a variável resposta. Incluiu-se neste relatório todas as análises bivariadas (com exceção de titularidade, por ausência de variabilidade), bem como a relação multivariada detectada — a interação de renda, inadimplência e cancelamento.</p>
<p>Na etapa de modelagem, buscou-se dois objetivos:</p>
<ul>
<li><ol type="1">
<li>Um modelo preditivo com excelentes métricas, que pudesse ser utilizado com segurança para previsão do risco de cancelamento de cada cliente;</li>
</ol></li>
<li><ol start="2" type="1">
<li>Um modelo explicativo, no qual fosse possível extrair interpretação de seus coeficientes para interpretação e diagnóstico de parâmetros, com objetivo de formular sugestões para ações estratégicas, que ainda preservasse métricas aceitáveis de ajuste.</li>
</ol></li>
</ul>
<p>Neste sentido, julgou-se pertinente selecionar e utilizar dois modelos diferentes, um para cada um destes objetivos. O modelo com melhores métricas em absoluto foi utilizado para previsão, enquanto um modelo auxiliar com métricas ligeiramente inferiores foi utilizado para interpretação de coeficientes e sugestão de ações estratégicas.</p>
<p>Neste relatório técnico, estão descritas as etapas de diagnóstico, análise e modelagem aplicada a este conjunto de dados — com aporte metodológico estatístico descrito na seção de metodologia —, bem como resultados obtidos e conclusões. Esta análise foi exitosa em encontrar um modelo preditivo bem ajustado, bem como em identificar e metrificar o impacto das características mais importantes para aumento ou diminuição de chance de cancelamento do plano de saúde, possibilitando assim a formulação de conclusões assertivas e sugestões de ações estratégicas baseadas em dados para reversão do cenário de alto churn.</p>
</section>
<section id="metodologia" class="level1">
<h1>Metodologia</h1>
<p>Para executar esta análise, utilizou-se a linguagem de programação Python, versão 3.12.3, junto com bibliotecas comuns de análise de dados, como pandas, numpy e scipy; bibliotecas de visualização como matplotlib, seaborn e plotly; bibliotecas de ciência de dados como Scikit-learn; além de outras bibliotecas necessárias para tarefas específicas no decorrer da análise, como geopandas, unicodedata, IPython, shap e warnings.</p>
<p>A criação e execução do jupyter notebook foi realizada no Visual Studio Code, enquanto este relatório técnico foi elaborado com Quarto, por meio da IDE RStudio. Para organização do projeto, criou-se um diretório privado no GitHub com os arquivos separados em pastas específicas, garantindo a inteligibilidade do projeto.</p>
<p>Para o escopo desta análise, fora fornecido um conjunto de dados com 101.063 observações (instâncias) e 12 variáveis (características). Alguns clientes, identificados pelo seu id único, apareciam mais de uma vez na tabela, configurando duplicata. Dessa forma, foram removidas as duplicidades, mantendo apenas uma observação por cliente. Dessas características, encontra-se a variável alvo (ou variável resposta — ou, simplesmente, variável), que corresponde ao status de cancelamento do cliente (churn). Conjuntamente, encontrava-se 10 variáveis explicativas (ou covariáveis), sendo elas: titularidade, faixa de renda, idade na adesão, tempo de plano em meses, sexo, quantidade de consultas, quantidade de internações, valor da mensalidade, unidade da federação e status de inadimplência do cliente. Essas covariáveis foram utilizadas para explicação do cancelamento, conforme seu potencial explicativo. Encontrava-se ainda uma coluna de identificação única de cada cliente, não utilizada nesta análise por não conter valor preditivo.</p>
<p>A quantidade de instâncias fornecidas é mais que suficiente para realizar modelagem preditiva. No contexto do estudo de dados, apesar de não existir um número analítico (estando este entre 1.000 e 10.000 instâncias), técnicas estatísticas clássicas como teste t para diferença de médias, teste não paramétrico de Kruskal-Wallis e outros utilizados para comparar grupos, tornam-se excessivamente sensíveis, identificando como significativas diferenças de magnitude irrelevante. Neste contexto, apenas técnicas mais sofisticadas, como as de aprendizado de máquina, são robustas para avaliar diferenças entre grupos e metrificar o impacto de características relevantes. Pode-se ainda remover algumas instâncias com inconsistências graves, isto é, que possuem problemas de preenchimento ou dados absurdos, em consonância com o princípio de good data over big data, como idade na adesão negativa ou tempo de plano em meses negativo, visto que estas instâncias não agregam valor ao modelo e podem prejudicar a análise. Além disso, esse processo também contemplou o tratamento de casos de separação perfeita, que poderiam comprometer a estabilidade de modelos explicativos. A quantidade de instâncias restantes permite ainda realizar a divisão de treino e teste, com massa de dados adequada para ambas as etapas.</p>
<p>Para análise exploratória dos dados, optou-se por visualizações gráficas e apresentação de estatísticas resumo em tabelas ou quadros. Para a modelagem de dados, utilizou-se diversos modelos contidos no scikit-learn, como regressão logística, árvore de decisão, árvore com bagging, florestas aleatórias e naive bayes.</p>
<p>Para avaliação dos modelos, utilizou-se métricas de avaliação recomendadas no escopo da ciência de dados, como acurácia (previsões corretas pelo total de previsões), precisão (verdadeiros positivos pelo total de positivos previstos), sensibilidade (verdadeiros positivos pela soma de verdadeiros positivos e falsos negativos), especificidade (verdadeiros negativos pela soma de falsos positivos e verdadeiros negativos), além do F1-Score e área sob a curva, além de visualizações como matriz de confusão, curva ROC e variable importance plot. Além disso, utilizou-se a técnica de validação cruzada para escolha de hiperparâmetros e validação dos modelos, com divisão dos dados em 80% para treino e 20% para teste e validação cruzada.</p>
<p>Destaca-se ainda que o balanceamento dos dados entre categorias das características, em especial para a variável resposta, pode representar um desafio para a modelagem. Algumas covariáveis como unidade da federação tiveram que ser agregadas em regiões para possibilitar a modelagem, pelo grave desbalanceamento de classes. Para a variável resposta, existiam mais clientes com cancelamento positivo que negativo, entretanto a diferença era pequena para uma grande massa de dados, o que em geral não é problemático para a maioria dos modelos. Ainda assim, quando da divisão entre treino e teste, estratificou-se as amostras em relação a esta variável, garantindo a proporção de cancelamentos e não cancelamentos em ambos os conjuntos de treino e teste.</p>
<p>Aplicou-se ainda técnicas para lidar com dados ausentes, como imputação ou remoção de instâncias em alguns casos. Para a modelagem, construiu-se algumas features baseadas nas covariáveis originais, além de procedimentos de pré processamento de dados, inclusive da seleção de features e covariáveis relevantes para cada caso. Detalhes da utilização destas técnicas em cada caso serão explicitadas nas seções de análise e modelagem.</p>
<div id="dd316933" class="cell" data-message="false" data-execution_count="2">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Patch</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> (LabelEncoder, StandardScaler, OneHotEncoder,FunctionTransformer, KBinsDiscretizer, PolynomialFeatures)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> VarianceThreshold, SelectKBest, mutual_info_classif</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> (train_test_split, StratifiedKFold, RandomizedSearchCV)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, BaggingClassifier</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> clone</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (accuracy_score, precision_score, recall_score,f1_score, roc_auc_score, confusion_matrix,classification_report, roc_curve)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> RocCurveDisplay, ConfusionMatrixDisplay</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> permutation_importance, PartialDependenceDisplay</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils.extmath <span class="im">import</span> safe_sparse_dot, fast_logdet</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percent(absolute, digits<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(<span class="dv">100</span> <span class="op">*</span> absolute <span class="op">/</span> <span class="bu">sum</span>(absolute), digits)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_acentos(texto):</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unicodedata.normalize(<span class="st">'NFKD'</span>, texto).encode(<span class="st">'ASCII'</span>, <span class="st">'ignore'</span>).decode(<span class="st">'ASCII'</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"pastel"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>cores <span class="op">=</span> {<span class="st">'SIM'</span>: <span class="st">'tomato'</span>, <span class="st">'NÃO'</span>: <span class="st">'steelblue'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="852e16d0" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"dados/processo_seletivo_base_churn.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="452bcbf7" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.lower()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'idadenaadesão'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'idadenaadesão'</span>: <span class="st">'idadenaadesao'</span>})</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'id_cliente'</span>] <span class="op">=</span> df[<span class="st">'id_cliente'</span>].astype(<span class="st">"category"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates(subset<span class="op">=</span>[<span class="st">'id_cliente'</span>], keep<span class="op">=</span><span class="st">'first'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>categorical_cols <span class="op">=</span> [<span class="st">'titularidade'</span>, <span class="st">'cancelado'</span>, <span class="st">'faixa_renda'</span>, <span class="st">'sexo'</span>, <span class="st">'uf'</span>, <span class="st">'inadimplente'</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df[categorical_cols] <span class="op">=</span> df[categorical_cols].astype(<span class="st">'category'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[(df[<span class="st">'idadenaadesao'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'idadenaadesao'</span>] <span class="op">&lt;=</span> <span class="dv">100</span>) <span class="op">&amp;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'tempo_de_plano_meses'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>) <span class="op">&amp;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">'uf'</span>].notna())]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>regioes <span class="op">=</span> {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norte'</span>: [<span class="st">"AC"</span>, <span class="st">"AM"</span>, <span class="st">"AP"</span>, <span class="st">"PA"</span>, <span class="st">"RO"</span>, <span class="st">"RR"</span>, <span class="st">"TO"</span>],</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nordeste'</span>: [<span class="st">"AL"</span>, <span class="st">"BA"</span>, <span class="st">"CE"</span>, <span class="st">"MA"</span>, <span class="st">"PB"</span>, <span class="st">"PE"</span>, <span class="st">"PI"</span>, <span class="st">"RN"</span>, <span class="st">"SE"</span>],</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Centro-Oeste'</span>: [<span class="st">"DF"</span>, <span class="st">"GO"</span>, <span class="st">"MS"</span>, <span class="st">"MT"</span>],</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sudeste'</span>: [<span class="st">"ES"</span>, <span class="st">"MG"</span>, <span class="st">"RJ"</span>, <span class="st">"SP"</span>],</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sul'</span>: [<span class="st">"PR"</span>, <span class="st">"RS"</span>, <span class="st">"SC"</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_regiao(uf):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> regiao, ufs <span class="kw">in</span> regioes.items():</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> uf <span class="kw">in</span> ufs:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> regiao</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'regiao'</span>] <span class="op">=</span> df[<span class="st">'uf'</span>].<span class="bu">apply</span>(get_regiao).astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="análise" class="level1">
<h1>Análise</h1>
<p>Nesta seção, iremos conduzir uma análise exploratória dos dados, contendo o cálculo da taxa de churn, análises bivariadas da variável ‘cancelado’ pelas demais covariáveis do conjunto de dados, bem como análise exploratória multivariada, onde buscaremos captar relações de interação entre mais de duas variáveis.</p>
<p>Note que a covariável titularidade não foi incluida neste relatório, visto que não apresentava variação — todos os clientes do conjunto de dados eram titulares do plano.</p>
<section id="taxa-de-churn" class="level2">
<h2 class="anchored" data-anchor-id="taxa-de-churn">Taxa de churn</h2>
<div id="ddc294e2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>churn_rate <span class="op">=</span> df[<span class="st">'cancelado'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)[<span class="st">'SIM'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>churn_rate <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>churn_rate<span class="sc">:.2f}</span><span class="ss">"</span>.replace(<span class="st">"."</span>, <span class="st">","</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Taxa global de churn: </span><span class="sc">{</span>churn_rate<span class="sc">}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Taxa global de churn: 58,85%</code></pre>
</div>
</div>
<p>Observa-se uma taxa de churn superior a 50% nos dados, indicando uma alta evasão de clientes do plano de saúde. Esta taxa é preocupante, visto que pode indicar problemas com o produto ou com o perfil do cliente atendido pela empresa.</p>
</section>
<section id="quantidade-de-cancelamentos-por-grupos" class="level2">
<h2 class="anchored" data-anchor-id="quantidade-de-cancelamentos-por-grupos">Quantidade de cancelamentos por grupos</h2>
<div id="0c9fc83e" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>faixa_renda <span class="op">=</span> df.groupby([<span class="st">'faixa_renda'</span>, <span class="st">'cancelado'</span>], observed<span class="op">=</span><span class="va">True</span>).size().unstack()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>faixa_renda[<span class="st">'total'</span>] <span class="op">=</span> faixa_renda.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>faixa_renda[<span class="st">'% NÃO'</span>] <span class="op">=</span> (faixa_renda[<span class="st">'NÃO'</span>] <span class="op">/</span> faixa_renda[<span class="st">'total'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>faixa_renda[<span class="st">'% SIM'</span>] <span class="op">=</span> (faixa_renda[<span class="st">'SIM'</span>] <span class="op">/</span> faixa_renda[<span class="st">'total'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>styled_faixa_renda <span class="op">=</span> (</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    faixa_renda.fillna(<span class="dv">0</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>faixa_renda.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>display(styled_faixa_renda)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'faixa_renda'</span>, hue<span class="op">=</span><span class="st">'cancelado'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>], </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>              order<span class="op">=</span>df[<span class="st">'faixa_renda'</span>].value_counts().index)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Cancelamentos por Faixa de Renda'</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Faixa de Renda'</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Contagem'</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Cancelado'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_89884" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_89884_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_89884_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
<th id="T_89884_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">total</th>
<th id="T_89884_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">% NÃO</th>
<th id="T_89884_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">% SIM</th>
</tr>
<tr class="odd">
<th class="index_name level0" data-quarto-table-cell-role="th">faixa_renda</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col2" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col3" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col4" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_89884_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">Alta renda</td>
<td id="T_89884_row0_col0" class="data row0 col0">7.402,00</td>
<td id="T_89884_row0_col1" class="data row0 col1">2.641,00</td>
<td id="T_89884_row0_col2" class="data row0 col2">10.043,00</td>
<td id="T_89884_row0_col3" class="data row0 col3">73,70</td>
<td id="T_89884_row0_col4" class="data row0 col4">26,30</td>
</tr>
<tr class="even">
<td id="T_89884_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">Baixa renda</td>
<td id="T_89884_row1_col0" class="data row1 col0">7.598,00</td>
<td id="T_89884_row1_col1" class="data row1 col1">50.777,00</td>
<td id="T_89884_row1_col2" class="data row1 col2">58.375,00</td>
<td id="T_89884_row1_col3" class="data row1 col3">13,02</td>
<td id="T_89884_row1_col4" class="data row1 col4">86,98</td>
</tr>
<tr class="odd">
<td id="T_89884_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">Média renda</td>
<td id="T_89884_row2_col0" class="data row2 col0">22.356,00</td>
<td id="T_89884_row2_col1" class="data row2 col1">0,00</td>
<td id="T_89884_row2_col2" class="data row2 col2">22.356,00</td>
<td id="T_89884_row2_col3" class="data row2 col3">100,00</td>
<td id="T_89884_row2_col4" class="data row2 col4">0,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-6-output-2.png" width="759" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Em geral, clientes de baixa renda tendem a ter alta taxa de cancelamento (86,98% dos clientes de baixa renda cancelaram). Dentre os clientes de renda média, não houve cancelamento algum. Para os clientes de alta renda, a evasão foi de 26,3%.</p>
<p>Estes resultados indicam que podem ser realizadas ações para clientes de faixas de renda específicas — em especial os de baixa renda — na busca da reversão da alta taxa de churn.</p>
</section>
<section id="cancelamento-por-idade-na-adesão" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-idade-na-adesão">Cancelamento por idade na adesão</h2>
<div id="79e55c1a" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>idade_na_adesao <span class="op">=</span> df.groupby(<span class="st">'cancelado'</span>, observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'idadenaadesao'</span>].describe().transpose().<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>styled_idade_na_adesao <span class="op">=</span> (</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    idade_na_adesao.fillna(<span class="dv">0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>idade_na_adesao.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>display(styled_idade_na_adesao)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'cancelado'</span>, x<span class="op">=</span><span class="st">'idadenaadesao'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>])</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Idade na Adesão por Status de Cancelamento'</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Idade na Adesão'</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Cancelado'</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_f2da9" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_f2da9_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_f2da9_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_f2da9_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">count</td>
<td id="T_f2da9_row0_col0" class="data row0 col0">37.356,00</td>
<td id="T_f2da9_row0_col1" class="data row0 col1">53.418,00</td>
</tr>
<tr class="even">
<td id="T_f2da9_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">mean</td>
<td id="T_f2da9_row1_col0" class="data row1 col0">29,17</td>
<td id="T_f2da9_row1_col1" class="data row1 col1">29,43</td>
</tr>
<tr class="odd">
<td id="T_f2da9_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">std</td>
<td id="T_f2da9_row2_col0" class="data row2 col0">16,91</td>
<td id="T_f2da9_row2_col1" class="data row2 col1">21,13</td>
</tr>
<tr class="even">
<td id="T_f2da9_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">min</td>
<td id="T_f2da9_row3_col0" class="data row3 col0">0,00</td>
<td id="T_f2da9_row3_col1" class="data row3 col1">0,00</td>
</tr>
<tr class="odd">
<td id="T_f2da9_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">25%</td>
<td id="T_f2da9_row4_col0" class="data row4 col0">16,00</td>
<td id="T_f2da9_row4_col1" class="data row4 col1">10,00</td>
</tr>
<tr class="even">
<td id="T_f2da9_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">50%</td>
<td id="T_f2da9_row5_col0" class="data row5 col0">30,00</td>
<td id="T_f2da9_row5_col1" class="data row5 col1">28,00</td>
</tr>
<tr class="odd">
<td id="T_f2da9_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">75%</td>
<td id="T_f2da9_row6_col0" class="data row6 col0">40,00</td>
<td id="T_f2da9_row6_col1" class="data row6 col1">44,00</td>
</tr>
<tr class="even">
<td id="T_f2da9_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">max</td>
<td id="T_f2da9_row7_col0" class="data row7 col0">82,00</td>
<td id="T_f2da9_row7_col1" class="data row7 col1">94,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-7-output-2.png" width="746" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Em relação à idade na adesão, os clientes que não cancelaram apresentam idade mediana de 30 anos, estando os primeiro e terceiro quartis nas idades 16 e 40 anos, respectivamente. Os clientes que cancelaram apresentam idade mediana de 28 anos, estando os primeiro e terceiro quartis nas idades 10 e 44 anos. Em geral, as idades média e mediana dos grupos são similares, em que clientes que cancelaram o plano apresentam idade mais heterogênea que clientes que não cancelaram.</p>
</section>
<section id="cancelamento-por-tempo-de-plano-em-meses" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-tempo-de-plano-em-meses">Cancelamento por tempo de plano em meses</h2>
<div id="6bd4c341" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tempo_de_plano_meses <span class="op">=</span> df.groupby(<span class="st">'cancelado'</span>, observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'tempo_de_plano_meses'</span>].describe().transpose().<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>styled_tempo_de_plano_meses <span class="op">=</span> (</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    tempo_de_plano_meses.fillna(<span class="dv">0</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>tempo_de_plano_meses.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>display(styled_tempo_de_plano_meses)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'cancelado'</span>, x<span class="op">=</span><span class="st">'tempo_de_plano_meses'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Tempo de Plano por Status de Cancelamento'</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Tempo de Plano (meses)'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Cancelado'</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_79d95" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_79d95_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_79d95_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_79d95_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">count</td>
<td id="T_79d95_row0_col0" class="data row0 col0">37.356,00</td>
<td id="T_79d95_row0_col1" class="data row0 col1">53.418,00</td>
</tr>
<tr class="even">
<td id="T_79d95_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">mean</td>
<td id="T_79d95_row1_col0" class="data row1 col0">301,42</td>
<td id="T_79d95_row1_col1" class="data row1 col1">229,05</td>
</tr>
<tr class="odd">
<td id="T_79d95_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">std</td>
<td id="T_79d95_row2_col0" class="data row2 col0">7,72</td>
<td id="T_79d95_row2_col1" class="data row2 col1">45,73</td>
</tr>
<tr class="even">
<td id="T_79d95_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">min</td>
<td id="T_79d95_row3_col0" class="data row3 col0">280,00</td>
<td id="T_79d95_row3_col1" class="data row3 col1">128,00</td>
</tr>
<tr class="odd">
<td id="T_79d95_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">25%</td>
<td id="T_79d95_row4_col0" class="data row4 col0">295,00</td>
<td id="T_79d95_row4_col1" class="data row4 col1">192,00</td>
</tr>
<tr class="even">
<td id="T_79d95_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">50%</td>
<td id="T_79d95_row5_col0" class="data row5 col0">303,00</td>
<td id="T_79d95_row5_col1" class="data row5 col1">233,00</td>
</tr>
<tr class="odd">
<td id="T_79d95_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">75%</td>
<td id="T_79d95_row6_col0" class="data row6 col0">309,00</td>
<td id="T_79d95_row6_col1" class="data row6 col1">268,00</td>
</tr>
<tr class="even">
<td id="T_79d95_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">max</td>
<td id="T_79d95_row7_col0" class="data row7 col0">311,00</td>
<td id="T_79d95_row7_col1" class="data row7 col1">311,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-8-output-2.png" width="746" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Quanto ao tempo do plano em meses, os clientes que cancelaram o plano apresentam média e mediana inferiores aos que não cancelaram o plano. Os clientes que não cancelaram o plano apresentam tempo mínimo de 280 meses, valor este superior ao terceiro quartil do tempo de permanência dos clientes que cancelaram. Para clientes com tempo igual ou superior a 295 meses de permanência, a massa de dados se concentra dentre os que não cancelaram o plano, indicando uma probabilidade de cancelamento desprezível após este tempo de permanência, se analisado somente esta variável.</p>
<p>Este resultado preliminar indica que ações de permanência no plano podem ser convenientes para reversão da alta taxa de churn, visto que marginalmente clientes que estão no plano a mais tempo apresentam menor propensão ao cancelamento deste.</p>
</section>
<section id="cancelamento-pelo-sexo-do-cliente" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-pelo-sexo-do-cliente">Cancelamento pelo sexo do cliente</h2>
<div id="18475750" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'sexo'</span>] <span class="op">=</span> df[<span class="st">'sexo'</span>].<span class="bu">map</span>({<span class="st">'F'</span>: <span class="st">'Feminino'</span>, <span class="st">'M'</span>: <span class="st">'Masculino'</span>})</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sexo <span class="op">=</span> df.groupby([<span class="st">'sexo'</span>, <span class="st">'cancelado'</span>], observed<span class="op">=</span><span class="va">True</span>).size().unstack()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>sexo[<span class="st">'total'</span>] <span class="op">=</span> sexo.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>sexo[<span class="st">'% NÃO'</span>] <span class="op">=</span> (sexo[<span class="st">'NÃO'</span>] <span class="op">/</span> sexo[<span class="st">'total'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>sexo[<span class="st">'% SIM'</span>] <span class="op">=</span> (sexo[<span class="st">'SIM'</span>] <span class="op">/</span> sexo[<span class="st">'total'</span>] <span class="op">*</span> <span class="dv">100</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>styled_sexo <span class="op">=</span> (</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    sexo.fillna(<span class="dv">0</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>sexo.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>display(styled_sexo)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'sexo'</span>, hue<span class="op">=</span><span class="st">'cancelado'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>])</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Cancelamentos por Sexo'</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Sexo'</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Contagem'</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Cancelado'</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_b1ce5" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_b1ce5_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_b1ce5_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
<th id="T_b1ce5_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">total</th>
<th id="T_b1ce5_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">% NÃO</th>
<th id="T_b1ce5_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">% SIM</th>
</tr>
<tr class="odd">
<th class="index_name level0" data-quarto-table-cell-role="th">sexo</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col2" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col3" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col4" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_b1ce5_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">Feminino</td>
<td id="T_b1ce5_row0_col0" class="data row0 col0">21.432,00</td>
<td id="T_b1ce5_row0_col1" class="data row0 col1">29.367,00</td>
<td id="T_b1ce5_row0_col2" class="data row0 col2">50.799,00</td>
<td id="T_b1ce5_row0_col3" class="data row0 col3">42,19</td>
<td id="T_b1ce5_row0_col4" class="data row0 col4">57,81</td>
</tr>
<tr class="even">
<td id="T_b1ce5_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">Masculino</td>
<td id="T_b1ce5_row1_col0" class="data row1 col0">15.198,00</td>
<td id="T_b1ce5_row1_col1" class="data row1 col1">23.006,00</td>
<td id="T_b1ce5_row1_col2" class="data row1 col2">38.204,00</td>
<td id="T_b1ce5_row1_col3" class="data row1 col3">39,78</td>
<td id="T_b1ce5_row1_col4" class="data row1 col4">60,22</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-9-output-2.png" width="759" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Existem mais clientes do sexo feminino do que clientes do sexo masculino. Existe uma taxa ligeiramente superior de cancelamento entre clientes do sexo feminino do que clientes do sexo masculino. Esta taxa não aparenta ser significativa, possivelmente tratando-se de ruído branco.</p>
</section>
<section id="cancelamento-por-unidade-da-federação-do-cliente" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-unidade-da-federação-do-cliente">Cancelamento por unidade da federação do cliente</h2>
<div id="a5085bee" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>uf_stats <span class="op">=</span> df.groupby(<span class="st">'uf'</span>, observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'cancelado'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>uf_stats <span class="op">=</span> uf_stats.reset_index().melt(id_vars<span class="op">=</span><span class="st">'uf'</span>, value_name<span class="op">=</span><span class="st">'taxa'</span>, var_name<span class="op">=</span><span class="st">'status'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>uf_stats_sim <span class="op">=</span> uf_stats[uf_stats[<span class="st">'status'</span>] <span class="op">==</span> <span class="st">'SIM'</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.choropleth(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    uf_stats_sim,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    geojson<span class="op">=</span><span class="st">"https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    locations<span class="op">=</span><span class="st">'uf'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    featureidkey<span class="op">=</span><span class="st">"properties.sigla"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'taxa'</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    scope<span class="op">=</span><span class="st">'south america'</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span><span class="st">'YlOrRd'</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Taxa de Cancelamento por UF (%)'</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'taxa'</span>: <span class="st">'Taxa de Cancelamento (%)'</span>}</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>fig.update_geos(fitbounds<span class="op">=</span><span class="st">"locations"</span>, visible<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span>{<span class="st">"r"</span>:<span class="dv">0</span>,<span class="st">"t"</span>:<span class="dv">40</span>,<span class="st">"l"</span>:<span class="dv">0</span>,<span class="st">"b"</span>:<span class="dv">0</span>})</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        </script>
        <script type="module">import "https://cdn.plot.ly/plotly-3.0.1.min"</script>
        
</div>
<div class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.0.1.min.js" integrity="sha256-oy6Be7Eh6eiQFs5M7oXuPxxm9qbJXEtTpfSI93dW16Q=" crossorigin="anonymous"></script>                <div id="7118c76e-655b-4e30-957c-d3d8dda317e1" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("7118c76e-655b-4e30-957c-d3d8dda317e1")) {                    Plotly.newPlot(                        "7118c76e-655b-4e30-957c-d3d8dda317e1",                        [{"coloraxis":"coloraxis","featureidkey":"properties.sigla","geo":"geo","geojson":"https:\u002f\u002fraw.githubusercontent.com\u002fcodeforamerica\u002fclick_that_hood\u002fmaster\u002fpublic\u002fdata\u002fbrazil-states.geojson","hovertemplate":"uf=%{location}\u003cbr\u003eTaxa de Cancelamento (%)=%{z}\u003cextra\u003e\u003c\u002fextra\u003e","locations":["AC","AL","AM","AP","BA","CE","DF","ES","GO","MA","MG","MS","MT","PA","PB","PE","PI","PR","RJ","RN","RO","RR","RS","SC","SE","SP","TO"],"name":"","z":{"dtype":"f8","bdata":"NIVAUwg0SUBXjx0BOshNQJ+BqHRkD1BAAAAAAAAASUBNAourotNIQILFPLCYB05ANYuct8A5R0DdYun5VlxSQHnOqNJO4U9AxOQKYnIFSUDRwuyiRGRRQErXJSzeLU5AlgnVKP2HS0ATO7ETOzFPQJIDzru6yU5ALJ+I2Vx6R0DT3AV\u002fFadRQHopETzSX1FAneZVY7T+TUDTAa5pbLFNQJq+ShibBU9ASpIkSZLkSUBywb7qQUpQQI7cyI3cyFBA0dFIHNUoS0D4w4z8pnpPQLDc0wjLPUtA"},"type":"choropleth"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"geo":{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]},"center":{},"scope":"south america","fitbounds":"locations","visible":false},"coloraxis":{"colorbar":{"title":{"text":"Taxa de Cancelamento (%)"}},"colorscale":[[0.0,"rgb(255,255,204)"],[0.125,"rgb(255,237,160)"],[0.25,"rgb(254,217,118)"],[0.375,"rgb(254,178,76)"],[0.5,"rgb(253,141,60)"],[0.625,"rgb(252,78,42)"],[0.75,"rgb(227,26,28)"],[0.875,"rgb(189,0,38)"],[1.0,"rgb(128,0,38)"]]},"legend":{"tracegroupgap":0},"title":{"text":"Taxa de Cancelamento por UF (%)"},"margin":{"r":0,"t":40,"l":0,"b":0}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('7118c76e-655b-4e30-957c-d3d8dda317e1');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
</div>
<p>O mapa coroplético evidencia diferenças estaduais e regionais com relação a taxa de churn. Regiões como sudeste e sul apresentam relativa homogeneidade, enquanto centro-oeste, norte e, principalmente, nordeste, apresentam maior heterogeneidade de taxa entre os estados. É possível que políticas de reversão possam ser aplicadas a nível estadual ou regional. Entretanto, a massa de dados se concentra em clientes do sudeste, o que pode afetar a sensibilidade de um modelo preditivo baseado nestes dados utilizando esta covariável. Desta forma, uma agregação possível é por região do cliente — ainda que isto possa mascarar heterogeneidades regionais, esta pode ser uma etapa necessária para obter um modelo melhor ajustado.</p>
</section>
<section id="cancelamento-por-inadimplência" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-inadimplência">Cancelamento por inadimplência</h2>
<div id="3e45c38b" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>inadimplencia <span class="op">=</span> pd.crosstab(df[<span class="st">'inadimplente'</span>], df[<span class="st">'cancelado'</span>], normalize<span class="op">=</span><span class="st">'index'</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>styled_inadimplencia <span class="op">=</span> (</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    inadimplencia.fillna(<span class="dv">0</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>inadimplencia.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>display(styled_inadimplencia)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'inadimplente'</span>, hue<span class="op">=</span><span class="st">'cancelado'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Cancelamentos por Inadimplência'</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Inadimplente'</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Contagem'</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Cancelado'</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_199d7" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_199d7_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_199d7_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
<tr class="odd">
<th class="index_name level0" data-quarto-table-cell-role="th">inadimplente</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_199d7_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">NÃO</td>
<td id="T_199d7_row0_col0" class="data row0 col0">51,81</td>
<td id="T_199d7_row0_col1" class="data row0 col1">48,19</td>
</tr>
<tr class="even">
<td id="T_199d7_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">SIM</td>
<td id="T_199d7_row1_col0" class="data row1 col0">12,06</td>
<td id="T_199d7_row1_col1" class="data row1 col1">87,94</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-11-output-2.png" width="759" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nota-se que os clientes adimplentes são maioria. Dentre os clientes inadimplentes, a grande maioria cancelou o plano. Dentre os adimplentes, a distribuição é razoavelmente uniforme entre cancelamento e não cancelamento.</p>
<p>Analisando marginalmente o efeito desta covariável, podemos dizer que a inadimplência do cliente aparenta ser fator significativo para cancelamento do plano. Ações de permanência para clientes inadimplentes podem ser delineadas para reversão do cenário de alto churn.</p>
</section>
<section id="cancelamento-por-quantidade-de-consultas-do-cliente-nos-últimos-12-meses" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-quantidade-de-consultas-do-cliente-nos-últimos-12-meses">Cancelamento por quantidade de consultas do cliente nos últimos 12 meses</h2>
<div id="31783003" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>qtd_consultas <span class="op">=</span> df.groupby(<span class="st">'cancelado'</span>, observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'qtd_consultas_12m'</span>].describe().transpose().<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>styled_qtd_consultas <span class="op">=</span> (</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    qtd_consultas.fillna(<span class="dv">0</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>qtd_consultas.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>display(styled_qtd_consultas)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'qtd_consultas_12m'</span>, hue<span class="op">=</span><span class="st">'cancelado'</span>, </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                 bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>, df[<span class="st">'qtd_consultas_12m'</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">7</span>, <span class="dv">7</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                 multiple<span class="op">=</span><span class="st">'dodge'</span>, kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                 palette<span class="op">=</span>{<span class="st">'SIM'</span>: <span class="st">'tomato'</span>, <span class="st">'NÃO'</span>: <span class="st">'steelblue'</span>})</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [Patch(facecolor<span class="op">=</span><span class="st">'tomato'</span>, label<span class="op">=</span><span class="st">'SIM'</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                   Patch(facecolor<span class="op">=</span><span class="st">'steelblue'</span>, label<span class="op">=</span><span class="st">'NÃO'</span>)]</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">'Cancelado'</span>, fontsize<span class="op">=</span><span class="st">"large"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Consultas nos Últimos 12 Meses'</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantidade de Consultas'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequência'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_44a58" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_44a58_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_44a58_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_44a58_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">count</td>
<td id="T_44a58_row0_col0" class="data row0 col0">37.356,00</td>
<td id="T_44a58_row0_col1" class="data row0 col1">53.418,00</td>
</tr>
<tr class="even">
<td id="T_44a58_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">mean</td>
<td id="T_44a58_row1_col0" class="data row1 col0">12,09</td>
<td id="T_44a58_row1_col1" class="data row1 col1">12,07</td>
</tr>
<tr class="odd">
<td id="T_44a58_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">std</td>
<td id="T_44a58_row2_col0" class="data row2 col0">10,69</td>
<td id="T_44a58_row2_col1" class="data row2 col1">10,80</td>
</tr>
<tr class="even">
<td id="T_44a58_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">min</td>
<td id="T_44a58_row3_col0" class="data row3 col0">1,00</td>
<td id="T_44a58_row3_col1" class="data row3 col1">1,00</td>
</tr>
<tr class="odd">
<td id="T_44a58_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">25%</td>
<td id="T_44a58_row4_col0" class="data row4 col0">5,00</td>
<td id="T_44a58_row4_col1" class="data row4 col1">5,00</td>
</tr>
<tr class="even">
<td id="T_44a58_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">50%</td>
<td id="T_44a58_row5_col0" class="data row5 col0">9,00</td>
<td id="T_44a58_row5_col1" class="data row5 col1">9,00</td>
</tr>
<tr class="odd">
<td id="T_44a58_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">75%</td>
<td id="T_44a58_row6_col0" class="data row6 col0">15,00</td>
<td id="T_44a58_row6_col1" class="data row6 col1">15,00</td>
</tr>
<tr class="even">
<td id="T_44a58_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">max</td>
<td id="T_44a58_row7_col0" class="data row7 col0">60,00</td>
<td id="T_44a58_row7_col1" class="data row7 col1">60,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-12-output-2.png" width="760" height="527" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A quantidade de consultas nos últimos 12 meses apresenta estatísticas de ordem e localização proporcionais se comparado clientes que cancelaram ou não o plano. Isto indica que esta variável, isoladamente, não explica bem o cancelamento do plano.</p>
</section>
<section id="cancelamento-por-quantidade-de-internações-do-cliente-nos-últimos-12-meses" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-quantidade-de-internações-do-cliente-nos-últimos-12-meses">Cancelamento por quantidade de internações do cliente nos últimos 12 meses</h2>
<div id="b45ce23c" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>qtd_internacoes <span class="op">=</span> df.groupby(<span class="st">'cancelado'</span>, observed <span class="op">=</span> <span class="va">True</span>)[<span class="st">'qtd_internacoes_12m'</span>].describe().transpose().<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>styled_qtd_internacoes <span class="op">=</span> (</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    qtd_internacoes.fillna(<span class="dv">0</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>qtd_internacoes.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>display(styled_qtd_internacoes)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'qtd_internacoes_12m'</span>, hue<span class="op">=</span><span class="st">'cancelado'</span>, </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>             bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>, df[<span class="st">'qtd_internacoes_12m'</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">7</span>, <span class="dv">7</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>             multiple<span class="op">=</span><span class="st">'dodge'</span>, kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                 palette<span class="op">=</span>{<span class="st">'SIM'</span>: <span class="st">'tomato'</span>, <span class="st">'NÃO'</span>: <span class="st">'steelblue'</span>})</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [Patch(facecolor<span class="op">=</span><span class="st">'tomato'</span>, label<span class="op">=</span><span class="st">'SIM'</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                   Patch(facecolor<span class="op">=</span><span class="st">'steelblue'</span>, label<span class="op">=</span><span class="st">'NÃO'</span>)]</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">'Cancelado'</span>, fontsize<span class="op">=</span><span class="st">"large"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Internações nos Últimos 12 Meses'</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Quantidade de Internações'</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequência'</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_fb55e" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_fb55e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_fb55e_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_fb55e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">count</td>
<td id="T_fb55e_row0_col0" class="data row0 col0">37.356,00</td>
<td id="T_fb55e_row0_col1" class="data row0 col1">53.418,00</td>
</tr>
<tr class="even">
<td id="T_fb55e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">mean</td>
<td id="T_fb55e_row1_col0" class="data row1 col0">1,30</td>
<td id="T_fb55e_row1_col1" class="data row1 col1">1,30</td>
</tr>
<tr class="odd">
<td id="T_fb55e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">std</td>
<td id="T_fb55e_row2_col0" class="data row2 col0">1,29</td>
<td id="T_fb55e_row2_col1" class="data row2 col1">1,30</td>
</tr>
<tr class="even">
<td id="T_fb55e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">min</td>
<td id="T_fb55e_row3_col0" class="data row3 col0">0,00</td>
<td id="T_fb55e_row3_col1" class="data row3 col1">0,00</td>
</tr>
<tr class="odd">
<td id="T_fb55e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">25%</td>
<td id="T_fb55e_row4_col0" class="data row4 col0">1,00</td>
<td id="T_fb55e_row4_col1" class="data row4 col1">1,00</td>
</tr>
<tr class="even">
<td id="T_fb55e_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">50%</td>
<td id="T_fb55e_row5_col0" class="data row5 col0">1,00</td>
<td id="T_fb55e_row5_col1" class="data row5 col1">1,00</td>
</tr>
<tr class="odd">
<td id="T_fb55e_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">75%</td>
<td id="T_fb55e_row6_col0" class="data row6 col0">2,00</td>
<td id="T_fb55e_row6_col1" class="data row6 col1">2,00</td>
</tr>
<tr class="even">
<td id="T_fb55e_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">max</td>
<td id="T_fb55e_row7_col0" class="data row7 col0">9,00</td>
<td id="T_fb55e_row7_col1" class="data row7 col1">9,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-13-output-2.png" width="768" height="527" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A quantidade de internações nos últimos 12 meses apresenta estatísticas de ordem e localização proporcionais ou exatamente iguais se comparado clientes que cancelaram ou não o plano. Isto indica que esta variável, isoladamente, não explica bem o cancelamento do plano.</p>
</section>
<section id="cancelamento-por-valor-da-mensalidade-do-plano" class="level2">
<h2 class="anchored" data-anchor-id="cancelamento-por-valor-da-mensalidade-do-plano">Cancelamento por valor da mensalidade do plano</h2>
<div id="e8a33bfa" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>valor_mensalidade <span class="op">=</span> df.groupby(<span class="st">'cancelado'</span>, observed <span class="op">=</span> <span class="va">True</span>)[<span class="st">'valor_mensalidade'</span>].describe().transpose().<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>styled_valor_mensalidade <span class="op">=</span> (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    valor_mensalidade.fillna(<span class="dv">0</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    .style</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:,.2f}</span><span class="st">"</span>, subset<span class="op">=</span>valor_mensalidade.columns,thousands<span class="op">=</span><span class="st">"."</span>, decimal<span class="op">=</span><span class="st">","</span>, na_rep<span class="op">=</span><span class="st">"0"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>display(styled_valor_mensalidade)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'cancelado'</span>, x<span class="op">=</span><span class="st">'valor_mensalidade'</span>, palette<span class="op">=</span>[<span class="st">'steelblue'</span>,<span class="st">'tomato'</span>])</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição de Valor de Mensalidade por Status de Cancelamento'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Valor da Mensalidade'</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Cancelado'</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<style type="text/css">
</style>

<table id="T_92f90" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="index_name level0" data-quarto-table-cell-role="th">cancelado</th>
<th id="T_92f90_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">NÃO</th>
<th id="T_92f90_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">SIM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_92f90_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">count</td>
<td id="T_92f90_row0_col0" class="data row0 col0">23.644,00</td>
<td id="T_92f90_row0_col1" class="data row0 col1">33.731,00</td>
</tr>
<tr class="even">
<td id="T_92f90_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">mean</td>
<td id="T_92f90_row1_col0" class="data row1 col0">898,77</td>
<td id="T_92f90_row1_col1" class="data row1 col1">928,94</td>
</tr>
<tr class="odd">
<td id="T_92f90_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">std</td>
<td id="T_92f90_row2_col0" class="data row2 col0">349,60</td>
<td id="T_92f90_row2_col1" class="data row2 col1">426,84</td>
</tr>
<tr class="even">
<td id="T_92f90_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">min</td>
<td id="T_92f90_row3_col0" class="data row3 col0">550,00</td>
<td id="T_92f90_row3_col1" class="data row3 col1">550,00</td>
</tr>
<tr class="odd">
<td id="T_92f90_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">25%</td>
<td id="T_92f90_row4_col0" class="data row4 col0">550,00</td>
<td id="T_92f90_row4_col1" class="data row4 col1">550,00</td>
</tr>
<tr class="even">
<td id="T_92f90_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">50%</td>
<td id="T_92f90_row5_col0" class="data row5 col0">720,00</td>
<td id="T_92f90_row5_col1" class="data row5 col1">720,00</td>
</tr>
<tr class="odd">
<td id="T_92f90_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">75%</td>
<td id="T_92f90_row6_col0" class="data row6 col0">1.030,00</td>
<td id="T_92f90_row6_col1" class="data row6 col1">1.030,00</td>
</tr>
<tr class="even">
<td id="T_92f90_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">max</td>
<td id="T_92f90_row7_col0" class="data row7 col0">1.870,00</td>
<td id="T_92f90_row7_col1" class="data row7 col1">1.870,00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-14-output-2.png" width="746" height="524" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O valor da mensalidade apresenta estatísticas de ordem e localização similares em ambos os grupos (clientes que cancelaram, clientes que não cancelaram). Isto indica que esta variável não explica bem o cancelamento ou não do plano, se analisada isoladamente.</p>
</section>
<section id="renda-por-inadimplência-por-cancelamento" class="level2">
<h2 class="anchored" data-anchor-id="renda-por-inadimplência-por-cancelamento">Renda por inadimplência por cancelamento</h2>
<div id="f78032c5" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_prop <span class="op">=</span> (df.groupby([<span class="st">'faixa_renda'</span>, <span class="st">'inadimplente'</span>, <span class="st">'cancelado'</span>], observed <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>           .size()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           .reset_index(name<span class="op">=</span><span class="st">'n'</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df_prop[<span class="st">'prop'</span>] <span class="op">=</span> (df_prop.groupby([<span class="st">'faixa_renda'</span>, <span class="st">'inadimplente'</span>], observed <span class="op">=</span> <span class="va">False</span>)[<span class="st">'n'</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                   .transform(<span class="kw">lambda</span> x: x <span class="op">/</span> x.<span class="bu">sum</span>()))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_prop[<span class="st">'faixa_renda'</span>] <span class="op">=</span> pd.Categorical(df_prop[<span class="st">'faixa_renda'</span>], </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                       categories<span class="op">=</span>[<span class="st">'Baixa renda'</span>, <span class="st">'Média renda'</span>, <span class="st">'Alta renda'</span>],</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                       ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df_prop, col<span class="op">=</span><span class="st">'inadimplente'</span>, height<span class="op">=</span><span class="dv">4</span>, aspect<span class="op">=</span><span class="dv">1</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_stacked_bar(data, <span class="op">**</span>kwargs):</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data.sort_values(<span class="st">'cancelado'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cancelado <span class="kw">in</span> [<span class="st">'NÃO'</span>, <span class="st">'SIM'</span>]:</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        subset <span class="op">=</span> data[data[<span class="st">'cancelado'</span>] <span class="op">==</span> cancelado]</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="st">'steelblue'</span> <span class="cf">if</span> cancelado <span class="op">==</span> <span class="st">'NÃO'</span> <span class="cf">else</span> <span class="st">'tomato'</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        plt.bar(x<span class="op">=</span>subset[<span class="st">'faixa_renda'</span>], </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                height<span class="op">=</span>subset[<span class="st">'prop'</span>], </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                bottom<span class="op">=</span>bottom,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>color,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span>cancelado)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> bottom <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            bottom <span class="op">=</span> subset[<span class="st">'prop'</span>].values</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            bottom <span class="op">+=</span> subset[<span class="st">'prop'</span>].values</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(draw_stacked_bar)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">'Faixa de Renda'</span>, <span class="st">'Proporção'</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">'Inadimplente: </span><span class="sc">{col_name}</span><span class="st">'</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>g.fig.legend(handles<span class="op">=</span>legend_elements, </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>             title<span class="op">=</span><span class="st">'Cancelado'</span>,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>             loc<span class="op">=</span><span class="st">'upper center'</span>,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>             bbox_to_anchor<span class="op">=</span>(<span class="fl">.9</span>, <span class="fl">1.1</span>),</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>             ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 864x576 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-15-output-2.png" width="778" height="421" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Ao analisar conjuntamente a faixa de renda, inadimplência e cancelamento, nota-se que para os clientes de alta renda, o inadimplento é variável significativa para indicar o cancelamento ou não do plano. Isto indica que pode ser necessária uma política específica para clientes inadimplentes de alta renda, visto que este perfil predomina para o cancelamento do plano ante clientes de alta renda não inadimplentes.</p>
</section>
<section id="conclusão-da-análise-exploratória" class="level2">
<h2 class="anchored" data-anchor-id="conclusão-da-análise-exploratória">Conclusão da análise exploratória</h2>
<p>Comparando os grupos de clientes que cancelaram ou não o plano utilizando análises bivariadas, nota-se que dos dados fornecidos, apenas alguns apresentam indícios de significância na determinação do cancelamento ou não do plano.</p>
<p>As variáveis mais significativas — visualmente — foram renda, tempo em meses do plano, unidade da federação do cliente e inadimplência.</p>
<p>Além disso, nota-se interação entre a faixa de renda e o inadimplento para explicar o cancelamento do plano dentre os clientes de alta renda. A maior parte dos clientes de alta renda que cancelaram o plano estavam inadimplentes.</p>
<p>Testes estatísticos para diferença de média ou mediana nos grupos não são adequados, pelo tamanho do conjunto de dados (90.774 instâncias, após remoção de dados absurdos e duplicatas), pois seriam viesados pelo tamanho amostral e detectariam significância em diversos casos pouco significativos.</p>
<p>O agrupamento das unidades da federação em regiões (Norte, Nordeste, Sudeste, Centro-Oeste e Sul) manteria a significância da diferença entre os grupos, entretanto poderia mascarar algumas heterogeneidades regionais (Como o estado do Piauí, que difere significativamente da tendência dos demais estados do Nordeste). Este agrupamento será realizado na modelagem pois a quantidade de instâncias é insuficiente na estratificação dos grupos para algumas unidades da federação.</p>
<p>Nota-se portanto que a alta taxa de churn aparenta estar mais relacionada com o perfil do cliente do que com o produto da empresa em si, visto que covariáveis mais relacionadas ao produto, como quantidade de consultas, quantidade de internações e valor da mensalidade não apresentaram diferenças entre clientes que cancelaram ou não o plano. Isto pode indicar maior necessidade de compreensão e ações relacionadas ao perfil do cliente do que a readequação do produto oferecido.</p>
</section>
</section>
<section id="modelagem" class="level1">
<h1>Modelagem</h1>
<p>A análise exploratória é uma etapa fundamental para a compreensão preliminar das covariáveis, especialmente em conjuntos de dados com grande volume de informações. Ela permite identificar padrões marginais e potenciais associações entre características, servindo como base para hipóteses e direcionamento da modelagem. No entanto, seu caráter descritivo a torna insuficiente para a obtenção de conclusões inferenciais ou para a avaliação do impacto isolado de cada variável.</p>
<p>Para alcançar esses objetivos — estimar o risco de cancelamento e identificar os fatores mais relevantes para a evasão de clientes — é necessário recorrer a métodos de modelagem estatística e aprendizado de máquina. Dada a natureza do problema, que envolve uma variável resposta binária (cancelamento ou não), optou-se por utilizar algoritmos de classificação.</p>
<p>Foram testados tanto modelos mais simples e interpretáveis, como a regressão logística e a árvore de decisão, quanto algoritmos mais robustos e complexos, como florestas aleatórias e árvores com bagging. Essas abordagens permitem comparar diferentes estratégias de modelagem em termos de desempenho preditivo e interpretabilidade. A seleção final dos modelos considerou não apenas métricas de ajuste, mas também a capacidade de fornecer subsídios para decisões estratégicas.</p>
<section id="política-para-valores-ausentes" class="level2">
<h2 class="anchored" data-anchor-id="política-para-valores-ausentes">Política para valores ausentes</h2>
<p>Diversos tratamentos podem ser realizados no conjunto de dados para lidar com dados ausentes. Ainda na fase da análise exploratória, optou-se por remover algumas instâncias com valores ausentes, sendo elas: idade na adesão ao plano inferior a zero anos ou superior a 100 anos; tempo de plano em meses inferior à zero e unidade da federação não preenchida. Em muitos casos, cada instância é preciosa e devemos evitar ao máximo sua eliminação. Entretanto, neste contexto, a quantidade de observações é suficientemente robusta, permitindo a exclusão de um pequeno número delas sem prejuízo à análise. Para além disso, julguei que o mau preenchimento destas colunas poderia indicar problema no preenchimento de demais informações da instância, o que poderia levar a um viés no modelo, caso fossem imputados valores mais coerentes, como tempo médio ou mediano, ou ainda rótulo de unidade da federação (que, nesse caso, quase certamente seria preenchido com valores mais frequentes — isto é, estados localizados no sudeste).</p>
<p>Para valores ausentes nas covariáveis numéricas referentes a quantidade de consultas e internações, julguei apropriado realizar a imputação com a mediana, tendo visto que:</p>
<ul>
<li><p>estas covariáveis não apresentavam grande diferença entre clientes que cancelaram ou não na análise exploratória;</p></li>
<li><p>as respectivas distribuições incorriam em forte fuga à normalidade, sendo mais indicado a imputação pela mediana neste caso, em detrimento da média.</p></li>
</ul>
<p>A covariável sexo também apresentava valores ausentes e, visto sua marginal insignificância aparente na etapa exploratória na determinação do cancelamento ou não por parte do cliente, optou-se por simplesmente não incluir esta covariável na modelagem.</p>
</section>
<section id="construção-de-features" class="level2">
<h2 class="anchored" data-anchor-id="construção-de-features">Construção de features</h2>
<p>Na análise exploratória, construiu-se apenas uma feature: Região (regiao), baseada na unidade da federação do cliente. A construção de features, isto é, novas covariáveis como modificações e/ou combinação das covariáveis existentes, podem ser cruciais na etapa de modelagem, ao custo de redução do entendimento e explicabilidade do modelo ao final. Desta forma, evitou-se construir features mais complexas em uma primeiro momento, para preservar a explicabilidade do modelo.</p>
</section>
<section id="o-modelo-geral" class="level2">
<h2 class="anchored" data-anchor-id="o-modelo-geral">O modelo geral</h2>
<p>Será considerada para modelagem a variável dependente “cancelado” (SIM/NÃO) como resposta, sendo explicada pelas demais covariáveis selecionadas, à excessão de: id_cliente, titularidade, sexo e unidade da federação.</p>
<p>id_cliente é simplesmente a identificação única de cada cliente, não havendo sentido em sua inserção para modelagem (servindo apenas para remoção de duplicatas); sexo por problemas de valores ausentes e baixo indicativo de significância na análise exploratória; titularidade pela ausência de variância; e unidade da federação pelo baixo número de instâncias para algumas unidades da federação, o que confundia o modelo — para esta, optou-se pela feature agregada Região (regiao).</p>
</section>
<section id="pré-processamento" class="level2">
<h2 class="anchored" data-anchor-id="pré-processamento">Pré processamento</h2>
<p>Uma camada adicional de filtragem foi adicionada nesta etapa: a remoção das instâncias cuja renda observada foi “Média”. Isto por que, conforme observado na etapa exploratória, existe a separação perfeita — nenhum cliente de renda média cancelou o plano. Isto certamente levaria a um modelo com problemas de generalização, visto que quase certamente um cliente de renda média sempre seria classificado como não cancelado, ainda que no futuro possa haver algum cliente de renda média que por ventura cancele o plano. Para além disso, esta informação certamente distorceria os parâmetros dos modelos, inclusive podendo levar modelos mais sensíveis à separação perfeita — como a regressão logística — a ter problemas de convergência. Como a remoção destas observações ainda preserva um volume de dados extremamente satisfatório, julgo ser seguro simplesmente optar por não inseri-los no modelo.</p>
<p>Outras informações identificadas como potencialmente não relevantes na etapa exploratória serão mantidas nesta etapa, podendo ser removidas na comparação de modelos posteriormente.</p>
<div id="540554d5" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'id_cliente'</span>, <span class="st">'titularidade'</span>, <span class="st">'sexo'</span>, <span class="st">'uf'</span>])</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'cancelado'</span>] <span class="op">=</span> df[<span class="st">'cancelado'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'SIM'</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">'faixa_renda'</span>].isin([<span class="st">'Baixa renda'</span>, <span class="st">'Alta renda'</span>])].copy()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'cancelado'</span>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'cancelado'</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">150167636</span>, stratify<span class="op">=</span>y)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>, <span class="st">'category'</span>]).columns</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'onehot'</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>,drop<span class="op">=</span><span class="st">'first'</span>))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>log_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'median'</span>)),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'log'</span>, FunctionTransformer(np.log1p))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>tempo_plano_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'log_transform'</span>, log_transformer),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'scaler'</span>, StandardScaler())</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>outras_numericas_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'median'</span>)),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'scaler'</span>, StandardScaler())</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> X_train.select_dtypes(include<span class="op">=</span>[<span class="st">'int64'</span>, <span class="st">'float64'</span>]).columns</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>features_para_log <span class="op">=</span> [<span class="st">'tempo_de_plano_meses'</span>]</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>features_outras_numericas <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> numeric_features <span class="cf">if</span> f <span class="kw">not</span> <span class="kw">in</span> features_para_log]</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'log_tempo'</span>, tempo_plano_transformer, features_para_log),</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'num'</span>, outras_numericas_transformer, features_outras_numericas),</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cat'</span>, categorical_transformer, categorical_features)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="definindo-modelos" class="level2">
<h2 class="anchored" data-anchor-id="definindo-modelos">Definindo modelos</h2>
<p>Diversos modelos podem ser escolhidos para a tarefa de classificação binária. Naive Bayes, regressão logística, árvores de decisão, florestas aleatórias, árvores com bagging, XGBoost, Gradient Boost e demais modelos. Além disso, é crucial realizar o fine tuning dos parâmetros de cada modelo, visto que cada um deles contém diversos hiperparâmetros, e a combinação ótima em geral só pode ser encontrada por força bruta. Diversas estratégias podem ser pensadas para teste de hiperparâmetros, como um grid plano, um quadrado latino, uma busca aleatória, varreduras bayesianas, etc. Em geral, opta-se pelo método mais simples — a busca plana — e testa-se métodos mais sofisticados caso hiperparâmetros ideais não sejam encontrados, ou se houver problema de tempo de execução das buscas no grid.</p>
<div id="3fc7586c" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Naive_Bayes'</span>: {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model'</span>: GaussianNB(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'var_smoothing'</span>: np.logspace(<span class="dv">0</span>,<span class="op">-</span><span class="dv">9</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Logistic_Regression'</span>: {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model'</span>: LogisticRegression(),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'C'</span>: np.logspace(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">20</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>],</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'solver'</span>: [<span class="st">'liblinear'</span>]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Decision_Tree'</span>: {</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model'</span>: DecisionTreeClassifier(),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: {</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_depth'</span>: [<span class="va">None</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>],</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_samples_leaf'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Bagging_Tree'</span>: {</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model'</span>: BaggingClassifier(base_estimator<span class="op">=</span>DecisionTreeClassifier()),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: {</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n_estimators'</span>: [<span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>],</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'base_estimator__max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>]</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Random_Forest'</span>: {</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'model'</span>: RandomForestClassifier(),</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'params'</span>: {</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_depth'</span>: [<span class="va">None</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>],</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>]</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="validação-cruzada-ajuste-dos-modelos-e-tuning-de-hiperparâmetros" class="level2">
<h2 class="anchored" data-anchor-id="validação-cruzada-ajuste-dos-modelos-e-tuning-de-hiperparâmetros">Validação cruzada, ajuste dos modelos e tuning de hiperparâmetros</h2>
<div id="44387100" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">150167636</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, config <span class="kw">in</span> models.items():</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'feature_selection'</span>, VarianceThreshold()),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'model'</span>, config[<span class="st">'model'</span>])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {<span class="ss">f'model__</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">'</span>: value <span class="cf">for</span> key, value <span class="kw">in</span> config[<span class="st">'params'</span>].items()}</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    search <span class="op">=</span> RandomizedSearchCV(</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        pipeline,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        param_distributions<span class="op">=</span>params,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        n_iter<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        cv<span class="op">=</span>cv,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        scoring<span class="op">=</span><span class="st">'roc_auc'</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">150167636</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        return_train_score<span class="op">=</span><span class="va">True</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    search.fit(X_train, y_train)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> search.best_estimator_.predict(X_test)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    y_proba <span class="op">=</span> search.best_estimator_.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    results[name] <span class="op">=</span> {</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'search_cv'</span>: search,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'best_model'</span>: search.best_estimator_,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'best_params'</span>: search.best_params_,</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'best_score'</span>: search.best_score_,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'test_metrics'</span>: {</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'accuracy'</span>: accuracy_score(y_test, y_pred),</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'roc_auc'</span>: roc_auc_score(y_test, y_proba),</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'f1'</span>: f1_score(y_test, y_pred),</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'precision'</span>: precision_score(y_test, y_pred),</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'recall'</span>: recall_score(y_test, y_pred)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A validação é uma etapa crucial na modelagem. Os modelos sempre buscarão melhor ajuste possível aos dados, entretanto este ajuste pode significar a compreensão perfeita dos dados que forem a eles fornecidos, porém na avaliação de um dado futuro posterior, este modelo pode incorrer em erros em função de sobreajuste (overfitting), isto é, o modelo aprende exatamente os padrões dos dados que foram fornecidos, mas é incapaz de generalizar os resultados para novas observações. Para isso, uma das estratégias é separar o conjunto de dados em treino e teste, em geral utilizando 80% dos dados para treino e 20% dos dados para teste. Desta forma, as métricas do modelo serão avaliadas no conjunto de testes, conjunto este não utilizado para ajuste do modelo, para verificar o quão bem o modelo compreende padrões para além de decorar os dados que a ele foram fornecidos.</p>
<p>A validação cruzada é uma extensão desta ideia. Não iremos apenas ajustar os modelos, mas também selecionar as melhores combinações possíveis de hiperparâmetros deles. Para isso, podemos dividir o conjunto de dados em treino, teste e validação. Porém, quanto mais separações fazemos, menos dados temos para treino, e prescindir de uma boa quantidade destes pode não ser viável em algumas situações. Para isso, esta metodologia fragmenta o conjunto de treino em v segmentos (v-folds), utilizando uma parte desta para avaliação de hiperparâmetro durante o ajuste do modelo, e as 4 partes restantes para teste. Além disso, a implementação embaralha e troca a ordem desses segmentos a cada ajuste, garantindo a confiabilidade das métricas produzidas.</p>
<p>Desta forma, podemos avaliar o modelo, testar conjuntos de hiperparâmetros e testar a performance do modelo utilizando uma abordagem segura, confiável e crível.</p>
<div id="eb7aeec5" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> []</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, result <span class="kw">in</span> results.items():</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> result[<span class="st">'best_model'</span>].predict(X_test)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    y_proba <span class="op">=</span> result[<span class="st">'best_model'</span>].predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    metrics.append({</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Modelo'</span>: name,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Acurácia'</span>: accuracy_score(y_test, y_pred),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ROC AUC'</span>: roc_auc_score(y_test, y_proba),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'F1-Score'</span>: f1_score(y_test, y_pred),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Precisão'</span>: precision_score(y_test, y_pred),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Recall'</span>: recall_score(y_test, y_pred),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Especificidade'</span>: recall_score(y_test, y_pred, pos_label<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics).sort_values([<span class="st">'Acurácia'</span>, <span class="st">'ROC AUC'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'Acurácia'</span>] <span class="op">=</span> metrics_df[<span class="st">'Acurácia'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.2%}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'ROC AUC'</span>] <span class="op">=</span> metrics_df[<span class="st">'ROC AUC'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'F1-Score'</span>] <span class="op">=</span> metrics_df[<span class="st">'F1-Score'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'Precisão'</span>] <span class="op">=</span> metrics_df[<span class="st">'Precisão'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.2%}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'Recall'</span>] <span class="op">=</span> metrics_df[<span class="st">'Recall'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.2%}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>metrics_df[<span class="st">'Especificidade'</span>] <span class="op">=</span> metrics_df[<span class="st">'Especificidade'</span>].<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.2%}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Modelo</th>
<th data-quarto-table-cell-role="th">Acurácia</th>
<th data-quarto-table-cell-role="th">ROC AUC</th>
<th data-quarto-table-cell-role="th">F1-Score</th>
<th data-quarto-table-cell-role="th">Precisão</th>
<th data-quarto-table-cell-role="th">Recall</th>
<th data-quarto-table-cell-role="th">Especificidade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Bagging_Tree</td>
<td>94.74%</td>
<td>0.987</td>
<td>0.966</td>
<td>96.92%</td>
<td>96.32%</td>
<td>89.10%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Random_Forest</td>
<td>94.67%</td>
<td>0.987</td>
<td>0.966</td>
<td>97.35%</td>
<td>95.78%</td>
<td>90.70%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Decision_Tree</td>
<td>94.32%</td>
<td>0.982</td>
<td>0.964</td>
<td>96.67%</td>
<td>96.03%</td>
<td>88.23%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Logistic_Regression</td>
<td>93.96%</td>
<td>0.985</td>
<td>0.961</td>
<td>96.32%</td>
<td>95.94%</td>
<td>86.93%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Naive_Bayes</td>
<td>93.25%</td>
<td>0.979</td>
<td>0.956</td>
<td>96.90%</td>
<td>94.37%</td>
<td>89.23%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>O Quadro acima mostra as principais métricas associadas aos modelos testados. Nota-se que todos os modelos performaram relativamente bem em todas as métricas selecionadas, com destaque para a área sob a curva (ROC AUC). Isto indica que qualquer um dos modelos poderia ser utilizado para previsão, com F1-Score acima de 95%, que em geral é a métrica mais importante para avaliação de churn.</p>
<div id="d0ef7d1f" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_search_results(results):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    n_models <span class="op">=</span> <span class="bu">len</span>(results)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(n_models, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span> <span class="op">*</span> n_models))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_models <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        axes <span class="op">=</span> [axes]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (name, result), ax <span class="kw">in</span> <span class="bu">zip</span>(results.items(), axes):</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        search_cv <span class="op">=</span> result[<span class="st">'search_cv'</span>]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        cv_results <span class="op">=</span> search_cv.cv_results_</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        scores <span class="op">=</span> cv_results[<span class="st">'mean_test_score'</span>]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        ax.scatter(<span class="bu">range</span>(<span class="bu">len</span>(scores)), scores, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Performance do </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Combinação de hiperparâmetros'</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'ROC AUC Score'</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        ax.axhline(result[<span class="st">'best_score'</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout(pad<span class="op">=</span><span class="fl">3.0</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>plot_search_results(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-20-output-1.png" width="707" height="1860" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Os gráficos acima demonstram a necessidade de realizar o tuning de hiperparâmetros. Notamos que a performance de todos os modelos oscilam a depender da combinação de hiperparâmetros utilizada. Estaremos especialmente interessados nos modelos cuja combinação de hiperparâmetros foi a melhor possível, segundo alguma métrica selecionada.</p>
</section>
<section id="análise-de-importâncias-dos-melhores-modelos" class="level2">
<h2 class="anchored" data-anchor-id="análise-de-importâncias-dos-melhores-modelos">Análise de importâncias dos melhores modelos</h2>
<div id="e615a82e" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_feature_names_from_column_transformer(column_transformer):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    output_features <span class="op">=</span> []</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> name, trans, cols <span class="kw">in</span> column_transformer.transformers_:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> name <span class="op">==</span> <span class="st">'remainder'</span>:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(trans, Pipeline):</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">hasattr</span>(trans[<span class="op">-</span><span class="dv">1</span>], <span class="st">'get_feature_names_out'</span>):</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                    names <span class="op">=</span> trans[<span class="op">-</span><span class="dv">1</span>].get_feature_names_out(cols)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                    names <span class="op">=</span> cols</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                names <span class="op">=</span> cols</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">hasattr</span>(trans, <span class="st">'get_feature_names_out'</span>):</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                    names <span class="op">=</span> trans.get_feature_names_out(cols)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                    names <span class="op">=</span> cols</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                names <span class="op">=</span> cols</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        output_features.extend(names)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_features</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> results[<span class="st">'Random_Forest'</span>][<span class="st">'best_model'</span>]</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> get_feature_names_from_column_transformer(rf_model.named_steps[<span class="st">'preprocessor'</span>])</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> rf_model.named_steps[<span class="st">'model'</span>].feature_importances_</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>rf_importances <span class="op">=</span> pd.DataFrame({</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'feature'</span>: feature_names,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'importance'</span>: importances</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>}).sort_values(by<span class="op">=</span><span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>bag_model <span class="op">=</span> results[<span class="st">'Bagging_Tree'</span>][<span class="st">'best_model'</span>]</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>feature_names_bag <span class="op">=</span> get_feature_names_from_column_transformer(bag_model.named_steps[<span class="st">'preprocessor'</span>])</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>base_estimators <span class="op">=</span> bag_model.named_steps[<span class="st">'model'</span>].estimators_</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>importances_list <span class="op">=</span> [tree.feature_importances_ <span class="cf">for</span> tree <span class="kw">in</span> base_estimators]</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>avg_importances <span class="op">=</span> np.mean(importances_list, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>bag_importances <span class="op">=</span> pd.DataFrame({</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'feature'</span>: feature_names_bag,</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'importance'</span>: avg_importances</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>}).sort_values(by<span class="op">=</span><span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>rf_importances, x<span class="op">=</span><span class="st">'importance'</span>, y<span class="op">=</span><span class="st">'feature'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Random Forest"</span>)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>bag_importances, x<span class="op">=</span><span class="st">'importance'</span>, y<span class="op">=</span><span class="st">'feature'</span>, palette<span class="op">=</span><span class="st">'crest'</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"Bagging Tree"</span>)</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-21-output-1.png" width="756" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A Figura acima mostra as features mais importantes nos modelos que melhor perfomaram — bagging tree e random forest. Da Figura, podemos inferir que o fator mais importante para explicar o churn de clientes é o tempo de permanência no plano, em que clientes mais antigos são muito menos propensos a cancelar. Além disso, pode-se dizer que a renda também é característica importante, em que clientes de baixa renda são mais propensos a cancelar o plano em relação a categoria de referência (clientes de alta renda). Outros fatores foram menos relevantes, mas ainda podem ser considerados — como a inadimplência. Com qualquer um destes modelos, estamos munidos de poderosa ferramenta para prever o churn de um cliente, bem como ter alguma noção dos fatores mais importantes na determinação deste cenário. Em especial o modelo de random forest que, por ter obtido as melhores métricas ante aos outros testados, será o modelo escolhido e utilizado para previsão.</p>
<section id="problemáticas-desta-abordagem" class="level3">
<h3 class="anchored" data-anchor-id="problemáticas-desta-abordagem">Problemáticas desta abordagem</h3>
<p>Em geral estamos diante de um dos seguintes cenários no contexto da ciência de dados: previsão ou explicabilidade de fatores para áreas não técnicas. Busca-se dentre as opções o modelo com melhores métricas preditivas, como os modelos apresentados anteriormente. Porém, estes modelos costumam perder explicabilidade proporcionalmente com a sua capacidade preditiva. E isto pode ser um problema, pois dificulta a comunicação dos resultados, e a elaboração de ações para reversão de cenários apresentados pelo modelo. No caso concreto, temos interesse na reversão da alta taxa de churn, e queremos saber que tipo de atitudes e ações podemos adotar para a reversão deste cenário, bem como, se possível, metrificar o impacto de cada um dos fatores para traçarmos as principais estratégias, utilizando por exemplo uma matriz SWOT. Estes modelos indicam parcialmente a direção dos esforços, mas a metrificação exata dessa importância mostra-se bastante complicada. Além disso, foram ignoradas algumas conclusões parciais da etapa de análise exploratória, como a inclusão de covariáveis que aparentemente não eram significativamente diferentes entre os grupos que cancelaram e que não cancelaram o plano. Nota-se sobretudo o domínio da covariável relativa ao tempo de plano do cliente, que certamente é significativa, mas não é o único fator que pode ser acompanhado para elaboração de ações estratégicas.</p>
</section>
<section id="solução" class="level3">
<h3 class="anchored" data-anchor-id="solução">Solução</h3>
<p>Desta forma, uma abordagem que pode e deve ser adotada é a construção de um modelo auxiliar. Os modelos anteriores são excelentes para previsão, e poderão ser utilizados para este propósito. Entretanto, a construção de um modelo com maior parcimônia e lastro com a análise exploratória se faz necessária para extrair interpretação direta de coeficientes do modelo, tornando possível uma comunicação mais assertiva com a área administrativa sobre os impactos e a magnitude destes na análise de churn, possibilitando assim a formulação de estratégias eficientes para reversão deste cenário.</p>
</section>
</section>
<section id="o-modelo-interpretável" class="level2">
<h2 class="anchored" data-anchor-id="o-modelo-interpretável">O modelo interpretável</h2>
<p>Para a tarefa de classificação binária, um modelo especialmente interessante para interpretação de coeficientes é a regressão logística. Isto por que, por utilizar uma função de ligação logito e ter pressuposto de linearidade nos parâmetros, caso se ajuste bem, pode ser interpretado de seus coeficientes o aumento ou diminuição da chance de cancelamento do plano. Desta forma, poderemos quantificar não só quais fatores são mais importantes, mas o quão mais importantes são no cálculo dessa chance.</p>
<p>Para obter resultados coerentes, camadas adicionais de pré processamento serão realizadas para ajuste deste modelo. A regressão logística apresenta graves problemas em casos de separação perfeita dos dados, por conta da função logito. Nestes casos, os coeficientes “explodem” e perdem a interpretabilidade, ainda que o modelo esteja com métricas de previsão boas. Como a intenção deste modelo é a interpretação dos parâmetros (se preservadas métricas de ajuste aceitáveis), etapas adicionais de engenharia de features são necessárias, e serão descritas a seguir:</p>
<ul>
<li><p>A covariável tempo de plano em meses será categorizada, transformada em 4 categorias segundo seus quantis. Isto irá evitar a separação perfeita dos dados;</p></li>
<li><p>Como revelado na etapa exploratória, as covariáveis renda e inadimplência são melhor interpretadas se analisadas conjuntamente. Desta forma, será criada uma nova variável, que é a combinação entre os fatores destas duas, para melhor demonstrar este efeito;</p></li>
<li><p>Demais covariáveis indicadas como pouco significativas na etapa de análise exploratória serão desconsideradas.</p></li>
</ul>
<p>Desta forma, iremos ajustar o modelo explicando o cancelamento baseado em categorias da nova feature tempo de plano, inadimplência combinada com renda e região (agrupamento de unidades da federação segundo classificação do IBGE).</p>
<div id="01dbfb35" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tempo_plano_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'median'</span>)),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'binning'</span>, KBinsDiscretizer(n_bins<span class="op">=</span><span class="dv">4</span>, encode<span class="op">=</span><span class="st">'onehot-dense'</span>, strategy<span class="op">=</span><span class="st">'quantile'</span>)),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'remove_first'</span>, FunctionTransformer(<span class="kw">lambda</span> x: x[:, <span class="dv">1</span>:]))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_interactions(X):</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> X.copy()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">'faixa_renda'</span>] <span class="op">=</span> X[<span class="st">'faixa_renda'</span>].<span class="bu">map</span>({<span class="st">'Alta renda'</span>: <span class="dv">0</span>, <span class="st">'Baixa renda'</span>: <span class="dv">1</span>})</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">'inadimplente'</span>] <span class="op">=</span> X[<span class="st">'inadimplente'</span>].<span class="bu">map</span>({<span class="st">'NÃO'</span>: <span class="dv">0</span>, <span class="st">'SIM'</span>: <span class="dv">1</span>})</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    interactions <span class="op">=</span> pd.DataFrame({</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'alta_nao'</span>: (X[<span class="st">'faixa_renda'</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (X[<span class="st">'inadimplente'</span>] <span class="op">==</span> <span class="dv">0</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'alta_sim'</span>: (X[<span class="st">'faixa_renda'</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (X[<span class="st">'inadimplente'</span>] <span class="op">==</span> <span class="dv">1</span>),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'baixa_nao'</span>: (X[<span class="st">'faixa_renda'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (X[<span class="st">'inadimplente'</span>] <span class="op">==</span> <span class="dv">0</span>),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'baixa_sim'</span>: (X[<span class="st">'faixa_renda'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (X[<span class="st">'inadimplente'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    }).astype(<span class="bu">int</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> interactions[[<span class="st">'alta_sim'</span>, <span class="st">'baixa_nao'</span>, <span class="st">'baixa_sim'</span>]].values</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>interaction_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interaction'</span>, FunctionTransformer(create_interactions))</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>regiao_transformer <span class="op">=</span> Pipeline([</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'onehot'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>))</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'tempo_plano'</span>, tempo_plano_transformer, [<span class="st">'tempo_de_plano_meses'</span>]),</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'interaction'</span>, interaction_transformer, [<span class="st">'faixa_renda'</span>, <span class="st">'inadimplente'</span>]),</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'regiao'</span>, regiao_transformer, [<span class="st">'regiao'</span>])</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">'drop'</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Pipeline([</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'classifier'</span>, LogisticRegression(penalty<span class="op">=</span><span class="st">'l2'</span>, solver<span class="op">=</span><span class="st">'liblinear'</span>))</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> []</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>feature_names.extend([<span class="ss">f'tempo_plano_bin_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span>)])</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>feature_names.extend([</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_alta_inadimplente_sim'</span>,</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_baixa_inadimplente_nao'</span>, </span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_baixa_inadimplente_sim'</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>regiao_ohe <span class="op">=</span> model.named_steps[<span class="st">'preprocessor'</span>].named_transformers_[<span class="st">'regiao'</span>].named_steps[<span class="st">'onehot'</span>]</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>feature_names.extend(regiao_ohe.get_feature_names_out([<span class="st">'regiao'</span>]))</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(feature_names) <span class="op">==</span> <span class="bu">len</span>(model.named_steps[<span class="st">'classifier'</span>].coef_[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="métricas-do-modelo-interpretável" class="level3">
<h3 class="anchored" data-anchor-id="métricas-do-modelo-interpretável">Métricas do modelo interpretável</h3>
<div id="6bdd4ec8" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>y_proba <span class="op">=</span> model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> {</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Métrica"</span>: [<span class="st">"Acurácia"</span>, <span class="st">"Precisão"</span>, <span class="st">"Sensibilidade (Recall)"</span>, <span class="st">"Especificidade"</span>, <span class="st">"F1-Score"</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Valor"</span>: [</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>accuracy_score(y_test, y_pred)<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>precision_score(y_test, y_pred)<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>recall_score(y_test, y_pred)<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>recall_score(y_test, y_pred, pos_label<span class="op">=</span><span class="dv">0</span>)<span class="sc">:.1%}</span><span class="ss">"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>f1_score(y_test, y_pred)<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Métrica</th>
<th data-quarto-table-cell-role="th">Valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Acurácia</td>
<td>93.2%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Precisão</td>
<td>97.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sensibilidade (Recall)</td>
<td>94.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Especificidade</td>
<td>90.2%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>F1-Score</td>
<td>0.956</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="matriz-de-confusão-do-modelo-interpretável" class="level3">
<h3 class="anchored" data-anchor-id="matriz-de-confusão-do-modelo-interpretável">Matriz de confusão do modelo interpretável</h3>
<div id="d194678e" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix<span class="op">=</span>cm, display_labels<span class="op">=</span>[<span class="st">"Não Cancelou"</span>, <span class="st">"Cancelou"</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>disp.plot(cmap<span class="op">=</span><span class="st">'Blues'</span>, values_format<span class="op">=</span><span class="st">'d'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Matriz de Confusão"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 768x576 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-24-output-2.png" width="605" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="curva-roc-do-modelo-interpretável" class="level3">
<h3 class="anchored" data-anchor-id="curva-roc-do-modelo-interpretável">Curva ROC do modelo interpretável</h3>
<div id="3e01e97b" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fpr, tpr, _ <span class="op">=</span> roc_curve(y_test, y_proba)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>auc_value <span class="op">=</span> roc_auc_score(y_test, y_proba)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'darkorange'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'ROC curve (AUC = </span><span class="sc">{</span>auc_value<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Taxa de Falsos Positivos'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Taxa de Verdadeiros Positivos'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Curva ROC'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="relatorio_files/figure-html/cell-25-output-1.png" width="663" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O principal objetivo deste modelo será a extração de interpretação dos parâmetros. Como ajustou-se um modelo mais parcimonioso, é esperado que suas métricas sejam inferiores ao modelo saturado ajustado anteriormente. Isto é, para previsão, os modelos anteriores são ligeiramente melhores do que o modelo ajustado nesta etapa. Isso não significa que o modelo possa ser ruim: suas métricas devem ainda ser satisfatórias.</p>
<p>Conforme observado na análise de diagnóstico acima, como valores das principais métricas, área sob a curva e matriz de confusão, notamos uma ligeira piora de algumas métricas em relação ao modelo saturado, em especial na precisão de classificação de verdadeiros negativos. Entretanto, observando o conjunto das métricas em geral, pode-se dizer que este modelo se ajustou bem aos dados, em especial observando as métricas de F1-Score e área sob a curva — ambas performando acima de 95% — que são essenciais neste contexto.</p>
<p>Desta forma, podemos ter segurança na interpretação dos parâmetros deste modelo, e comunicação de seus resultados para as outras áreas da empresa</p>
<div id="af1a2310" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> model.named_steps[<span class="st">'classifier'</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>X_trans <span class="op">=</span> model.named_steps[<span class="st">'preprocessor'</span>].transform(X_train)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    pred_probs <span class="op">=</span> logreg.predict_proba(X_trans)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    sample_weights <span class="op">=</span> pred_probs[:, <span class="dv">1</span>] <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> pred_probs[:, <span class="dv">1</span>])</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    X_design <span class="op">=</span> np.hstack([np.ones((X_trans.shape[<span class="dv">0</span>], <span class="dv">1</span>)), X_trans])</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    weighted_X <span class="op">=</span> sample_weights[:, np.newaxis] <span class="op">*</span> X_design</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.linalg.inv(safe_sparse_dot(X_design.T, weighted_X))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Erro no cálculo da matriz de covariância: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    n_features <span class="op">=</span> X_trans.shape[<span class="dv">1</span>]</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.eye(n_features <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.01</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> np.sqrt(np.diag(cov_matrix))[<span class="dv">1</span>:] <span class="cf">if</span> cov_matrix <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> np.zeros(X_trans.shape[<span class="dv">1</span>])</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>z_scores <span class="op">=</span> logreg.coef_[<span class="dv">0</span>] <span class="op">/</span> se</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> stats.norm.sf(np.<span class="bu">abs</span>(z_scores)) <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>bin_edges <span class="op">=</span> model.named_steps[<span class="st">'preprocessor'</span>].named_transformers_[<span class="st">'tempo_plano'</span>].named_steps[<span class="st">'binning'</span>].bin_edges_[<span class="dv">0</span>]</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>feature_map <span class="op">=</span> {</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tempo_plano_bin_1'</span>: <span class="ss">f"Tempo: </span><span class="sc">{</span>bin_edges[<span class="dv">1</span>]<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>bin_edges[<span class="dv">2</span>]<span class="sc">:.0f}</span><span class="ss"> meses"</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tempo_plano_bin_2'</span>: <span class="ss">f"Tempo: </span><span class="sc">{</span>bin_edges[<span class="dv">2</span>]<span class="sc">:.0f}</span><span class="ss">-</span><span class="sc">{</span>bin_edges[<span class="dv">3</span>]<span class="sc">:.0f}</span><span class="ss"> meses"</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tempo_plano_bin_3'</span>: <span class="ss">f"Tempo: &gt;</span><span class="sc">{</span>bin_edges[<span class="dv">3</span>]<span class="sc">:.0f}</span><span class="ss"> meses"</span>,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_alta_inadimplente_sim'</span>: <span class="st">"Alta renda + Inadimplente"</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_baixa_inadimplente_nao'</span>: <span class="st">"Baixa renda + Não inadimplente"</span>,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_baixa_inadimplente_sim'</span>: <span class="st">"Baixa renda + Inadimplente"</span>,</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regiao_Norte'</span>: <span class="st">"Região Norte"</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regiao_Nordeste'</span>: <span class="st">"Região Nordeste"</span>,</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regiao_Sudeste'</span>: <span class="st">"Região Sudeste"</span>,</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'regiao_Sul'</span>: <span class="st">"Região Sul"</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Variável'</span>: [feature_map.get(f, f) <span class="cf">for</span> f <span class="kw">in</span> feature_names],</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Coeficiente'</span>: logreg.coef_[<span class="dv">0</span>],</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Erro Padrão'</span>: se,</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'z-value'</span>: z_scores,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p-value'</span>: [<span class="st">'&lt;0.0001'</span> <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.0001</span> <span class="cf">else</span> <span class="ss">f'</span><span class="sc">{</span>p<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">for</span> p <span class="kw">in</span> p_values],</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Odds Ratio'</span>: np.<span class="bu">round</span>(np.exp(logreg.coef_[<span class="dv">0</span>]), <span class="dv">4</span>)</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> results_df.reindex(logreg.coef_[<span class="dv">0</span>].argsort()[::<span class="op">-</span><span class="dv">1</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results_df.to_string(index<span class="op">=</span><span class="va">False</span>, float_format<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      Variável  Coeficiente  Erro Padrão  z-value p-value  Odds Ratio
    Baixa renda + Inadimplente       4.8816       0.0801  60.9565 &lt;0.0001    131.8379
Baixa renda + Não inadimplente       2.9060       0.0608  47.7791 &lt;0.0001     18.2839
          Tempo: 205-253 meses       1.9264       0.7675   2.5101  0.0121      6.8648
     Alta renda + Inadimplente       1.7975       0.1147  15.6764 &lt;0.0001      6.0344
                    Região Sul       0.7726       0.0863   8.9543 &lt;0.0001      2.1654
                Região Sudeste       0.5548       0.0656   8.4537 &lt;0.0001      1.7416
                  Região Norte       0.2458       0.1386   1.7728  0.0763      1.2786
               Região Nordeste      -0.1179       0.0669  -1.7632  0.0779      0.8888
          Tempo: 253-291 meses      -4.6209       0.2655 -17.4069 &lt;0.0001      0.0098
             Tempo: &gt;291 meses      -7.9566       0.2653 -29.9950 &lt;0.0001      0.0004</code></pre>
</div>
</div>
</section>
<section id="resultados-do-modelo-e-interpretação" class="level3">
<h3 class="anchored" data-anchor-id="resultados-do-modelo-e-interpretação">Resultados do modelo e interpretação</h3>
<p>A utilização do p-valor inferior a 0,05 é uma convenção útil na estatística, especialmente para estudos com amostras pequenas. Neste caso, visto a grande massa de dados, será considerado significante apenas coeficientes com p-valor inferior a 0,0001 — critério mais apropriado para este volume de dados –, isto é, significantes sob qualquer nível de confiança.</p>
<p>Fixada a categoria de referência: Clientes de alta renda não inadimplentes, moradores do centro-oeste e com tempo de plano até 205 meses, podemos ver como a alteração de um destes fatores — mantidos os restantes inalterados — impacta na chance de cancelamento do plano.</p>
<p>Dos fatores que aumentam a chance de cancelamento, destaca-se que clientes de baixa renda e inadimplentes apresentam chance de cancelamento 130 vezes superior em relação a categoria de referência. Recomenda-se prioridade para este recorte nas ações estratégicas para permanência no plano. Clientes de baixa renda não inadimplentes também apresentam chance de cancelamento 18 vezes superior aos clientes da categoria de referência. Isto indica que uma ação com vista na permanência para clientes de baixa renda, independente de inadimplência, pode ser crucial para reversão da alta taxa de churn. Ainda assim, a inadimplência é um fator relevante, pois clientes de alta renda inadimplentes apresentam uma chance superior a 6 vezes à chance de cancelamento do plano de clientes de alta renda adimplentes, o que indica que a reversão da inadimplência pode ser importante para permanência de clientes com este recorte de renda. Quanto a diferenças regionais, clientes das regiões Sul apresentam o dobro de chance de cancelamento — e 75% maior chance para clientes da região Sudeste —, indicando que políticas regionalizadas podem ser relevantes para reversão da alta taxa de churn nesas regiões.</p>
<p>O fator que diminui a chance de cancelamento é o tempo de permanência no plano. Clientes com permanência no plano entre 253 e 291 meses apresentam menos de 1% da chance de cancelamento dos clientes da categoria de referência, enquanto clientes com tempo de permanência superior a 291 meses apresentam chance de cancelamento de apenas 0,03% em relação aos clientes da categoria de referência, indicando que ações de permanência no plano por mais tempo podem levar a um cenário em que menos clientes cancelem o plano por já serem clientes muito antigos.</p>
</section>
</section>
</section>
<section id="resultados" class="level1">
<h1>Resultados</h1>
<p>A modelagem de dados confirma as tendências observadas na análise exploratória de dados. De fato, clientes com maior tempo de permanência no plano são muito menos propensos a cancelar. Esta é a informação considerada mais importante por todos os modelos analisados. A inadimplência do cliente, quando combinada a sua renda, também constitui um fator altamente explicativo, em que clientes inadimplentes tendem a cancelar mais o plano, em especial os clientes de baixa renda. Existe ainda um fator regional para algumas regiões, posto que clientes das regiões sul e sudeste têm mais propensão a cancelar o plano.</p>
<p>Todos os modelos selecionados performaram bem. Para análise preditiva, o modelo de random forest saturado é ligeiramente melhor que o modelo logístico, sendo portanto mais indicado para prever o risco de cancelamento de clientes. Com acurácia de 94,68%, esperamos que a grande massa de suas previsões estejam de acordo com o valor esperado na realidade.</p>
<p>Por outro lado, o modelo logístico obteve também resultados satisfatórios, sendo portanto seguro interpretar seus parâmetros com objetivo de extrair insights relevantes para formulação de estratégias de negócio direcionadas para perfis de cliente específicos. Com acurácia de 93,2%, em especial para clientes que não cancelaram o plano, temos segurança suficiente da lastreabilidade de seus parâmetros na realidade.</p>
</section>
<section id="conclusão" class="level1">
<h1>Conclusão</h1>
<p>Conforme especificado, o objetivo desta análise é estimar quais beneficiários têm maior risco de evasão nos próximos 12 meses, dado um modelo estatístico preditivo. Desta forma, podemos utilizar o modelo de random forest para realizar esta estimação.</p>
<p><strong>Distribuição de clientes por faixa de risco de cancelamento:</strong></p>
<div id="ef867b5e" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Mostrar o código</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> results[<span class="st">'Random_Forest'</span>][<span class="st">'best_model'</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>probas <span class="op">=</span> rf_model.predict_proba(X)[:, <span class="dv">1</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>faixas <span class="op">=</span> pd.cut(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    probas,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco até 10%'</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco entre 10</span><span class="sc">% e</span><span class="st"> 25%'</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco entre 25</span><span class="sc">% e</span><span class="st"> 50%'</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco entre 50</span><span class="sc">% e</span><span class="st"> 75%'</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco entre 70</span><span class="sc">% e</span><span class="st"> 90%'</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Risco superior a 90%'</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    include_lowest<span class="op">=</span><span class="va">True</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>contagem_por_faixa <span class="op">=</span> faixas.value_counts().sort_index()</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>risco_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Faixa de Risco'</span>: [</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Até 10%'</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'10% - 25%'</span>, </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'25% - 50%'</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'50% - 75%'</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'75% - 90%'</span>,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Acima de 90%'</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Clientes'</span>: contagem_por_faixa.values</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>risco_df[<span class="st">'Clientes'</span>] <span class="op">=</span> risco_df[<span class="st">'Clientes'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">"</span>.replace(<span class="st">","</span>, <span class="st">"."</span>))</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>display(risco_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Faixa de Risco</th>
<th data-quarto-table-cell-role="th">Clientes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Até 10%</td>
<td>7.145</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10% - 25%</td>
<td>3.595</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25% - 50%</td>
<td>5.181</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>50% - 75%</td>
<td>2.820</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>75% - 90%</td>
<td>2.111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Acima de 90%</td>
<td>47.566</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Note que isto se refere aos clientes que foram de fato inseridos no modelo (seja para treino, seja para teste). Deve-se observar que existem ainda 22.356 clientes removidos do modelo, não descritos na tabela acima, por serem classificados como renda média. Para estes clientes, como não houve cancelamento algum, pode-se dizer que o risco de cancelamento é zero ou próximo de zero.</p>
<p>Pode-se inferir ainda, dos resultados do modelo logístico, que os clientes com maior risco de cancelamento são clientes de baixa renda, inadimplentes ou não, com baixo tempo de permanência no plano.</p>
<p>Destas informações, nota-se que o produto oferecido pela empresa parece ser adequado, entretanto pode existir uma falta de alinhamento com as características de alguns grupos de clientes. Recomenda-se então ajustes no produto no sentido de melhor abarcar perfis diversos de clientes.</p>
<p>Algumas ações estratégicas que podem ser sugeridas são:</p>
<ul>
<li><p>Desconto regressivo para os clientes. Apesar do valor da mensalidade não ser significativo, o desconto regressivo poderia contribuir indiretamente para maior permanência no plano, em especial até 290 meses (pouco mais de 24 anos) de adesão — valor crítico no qual a chance do cliente evadir do plano se torna quase nula.</p></li>
<li><p>Revisão da política de inadimplência. Como a chance do cliente inadimplente cancelar o plano é extremamente significativa, em especial para clientes de baixa renda, recomenda-se, por exemplo, oferecer planos de pagamento facilitados para clientes de baixa renda, bem como revisão da política de cobrança para primeiras inadimplências, como também campanhas educativas e lembretes de pagamento para os clientes, em especial os de alta renda, antes de proceder para a inadimplência.</p></li>
<li><p>Avaliação da estrutura regional nos estados do sudeste e sul do país, como rede conveniada e estudo de concorrentes regionais.</p></li>
</ul>
<p>Para avaliação dessas estratégias, recomenda-se a implementação de um programa piloto com uma pequena quantidade de clientes em faixas de risco de cancelamento superior a 50% para posterior avaliação de efetividade dessas ações, utilizando técnicas como testes A/B ou inferência causal antes da implementação da ação na rede conveniada inteira.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/penasta\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>MIT License 2025, Bruno Gondim.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>